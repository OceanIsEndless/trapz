var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},ScaleControl,Constants,BaseGame,Utils;(function(n){var t=function(n){function t(t,i,r){var u=n.call(this,t,i,r,"text")||this;return u.setStyle({font:"Pixel Cyr",fill:"FFffff",align:"center",wordWrap:!0,wordWrapWidth:400}),u.anchor.setTo(.5,0),u.fontSize=22,u.lineSpacing=-5,u.align="center",u.stroke="#000",u.strokeThickness=16,u.colors=["#F7DF3C"],u.stroke="#000",u.strokeThickness=2,u.timeAlive=2500,u}return __extends(t,n),t.prototype.launch=function(){this.scale.set(.8);this.alpha=1;var n=this.game.add.tween(this.scale).to({x:1,y:1},300,Phaser.Easing.Linear.None,!0,0);n.onComplete.add(function(){this.hide()},this)},t.prototype.hide=function(){var n=this.game.add.tween(this).to({alpha:0},300,Phaser.Easing.Linear.None,!0,2500);n.onComplete.add(function(){this.destroy()},this)},t.prototype.destroy=function(){n.prototype.destroy.call(this);typeof this.playerBoundSpr!="undefined"&&this.playerBoundSpr!=null&&(this.playerBoundSpr.appearText=null)},t}(Phaser.Text);n.AppearText=t})(BaseGame||(BaseGame={})),function(n){var i,t;(function(n){n[n.VERTICAL=0]="VERTICAL";n[n.HORIZONTAL=1]="HORIZONTAL"})(i=n.BarOrient||(n.BarOrient={}));t=function(n){function t(t,i,r,u,f){var e=n.call(this,t)||this;return e.spriteFull=e.game.add.sprite(i,r,u),e.spriteEmpt=e.game.add.sprite(i,r,f),e.spriteEmpt.anchor.set(0,.5),e.spriteFull.anchor.set(0,.5),e.useCropRect=new Phaser.Rectangle(0,0,e.spriteFull.width*.5,e.spriteFull.height),e.spriteFull.crop(e.useCropRect,!1),e.add(e.spriteEmpt),e.add(e.spriteFull),e.originalWidth=e.spriteEmpt.width,e.updateProgress(1),e}return __extends(t,n),t.prototype.setAngle=function(n){this.spriteEmpt.angle=this.spriteFull.angle=n},t.prototype.setXY=function(n,t){this.spriteFull.x=this.spriteEmpt.x=n;this.spriteFull.y=this.spriteEmpt.y=t},t.prototype.updateValues=function(n,t){t===void 0&&(t=-1);t!=-1&&(this.fullAm=t);this.curAm=n;this.updateProgress(this.curAm/this.fullAm)},t.prototype.updateProgress=function(n){var t=Phaser.Math.clamp(n,0,1);t=Phaser.Math.clamp(t,1e-5,.99999);this.useCropRect.width=this.originalWidth*n;this.spriteFull.updateCrop();this.progress=n},t}(Phaser.Group);n.BarSpr=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.preload=function(){var n=".";this.game.add.plugin(new PhaserInput.Plugin(this.game,this.game.plugins));this.load.image("preloadBar",n+"/assets/barFull.png");this.load.image("preloadBarEmpt",n+"/assets/barEmpt.png");this.game.time.desiredFps=60},t.prototype.create=function(){this.firstRunLandscape=this.game.scale.isGameLandscape;this.input.maxPointers=1;this.stage.disableVisibilityChange=!0;this.game.device.desktop?(this.scale.pageAlignHorizontally=!0,this.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.scale.refresh()):(this.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.scale.minWidth=990*.5,this.scale.minHeight=630*.5,this.scale.maxWidth=990,this.scale.maxHeight=630,this.scale.forceLandscape=!0,this.scale.pageAlignHorizontally=!0,this.scale.refresh());this.game.scale.forceOrientation(!0,!1);this.game.scale.enterIncorrectOrientation.add(this.handleIncorrect);this.game.scale.leaveIncorrectOrientation.add(this.handleCorrect);console.log("this.game.device.desktop "+this.game.device.desktop);this.game.state.start("Preloader",!0,!1);this.game.add.text(0,0,"hack",{font:"Pixel Cyr",fill:"#FFFFFF"});window.game.onFocus.add(function(){window.game.input.enabled=!0;this.game.input.keyboard.start()},this);window.game.onBlur.add(function(){window.game.input.enabled=!1;this.game.input.keyboard.stop();this.game.input.keyboard.reset()},this)},t.prototype.handleIncorrect=function(){if(this.game==null){console.log("no game");return}console.log("show incorrect");document.getElementById("turn").style.display="block"},t.prototype.handleCorrect=function(){this.game!=null&&(console.log("show correct"),this.firstRunLandscape&&(this.gameRatio=window.innerWidth/window.innerHeight,this.game.width=Math.ceil(990*this.gameRatio),this.game.height=990,this.game.renderer.resize(this.game.width,this.game.height),Constants.MAIN_STATE!=null&&Constants.MAIN_STATE.resize()),document.getElementById("turn").style.display="none")},t.prototype.resize=function(){console.log("resize boot")},t}(Phaser.State);n.Boot=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t,i,r){var u=n.call(this,t,i,r,"coin",0)||this;return t.add.existing(u),u.outOfBoundsKill=!1,u.resetValues(),u}return __extends(t,n),t.prototype.resetValues=function(){this.collectedStarted=!1;this.revive();this.scale.set(1,1)},t.prototype.resize=function(){},t.prototype.animateTween=function(){},t.prototype.update=function(){},t}(Phaser.Sprite);n.Collectable=t}(BaseGame||(BaseGame={})),function(n){var t=function(t){function i(n,i,r){var u=t.call(this,n,i,r,"bigBlock",0)||this;return n.add.existing(u),n.physics.p2.enable(u),u.outOfBoundsKill=!1,u.resetValues(),u.body.static=!0,u}return __extends(i,t),i.prototype.resetValues=function(){this.collectedStarted=!1;this.revive();this.scale.set(1,1);this.body.allowGravity=!1;this.body.moves=!1;this.body.immovable=!0;this.body.setZeroVelocity()},i.prototype.resize=function(){},i.prototype.getHit=function(){this.typeName==n.CollideHitSpr.SPIKE&&Constants.MAIN_STATE.loseLife()},i.prototype.update=function(){},i}(Phaser.Sprite);n.CollideBlock=t}(BaseGame||(BaseGame={})),function(n){var t=function(t){function i(n,i,r){var u=t.call(this,n,i,r,"doubleSpikes",0)||this;return n.add.existing(u),n.physics.p2.enable(u),u.outOfBoundsKill=!1,u.body.static=!0,u.origPos=new Phaser.Point,u.resetValues(),u}return __extends(i,t),i.prototype.resetPos=function(){this.x=this.origPos.x;this.y=this.origPos.y},i.prototype.resetValues=function(){this.body.setZeroVelocity();this.collectedStarted=!1;this.revive();this.scale.set(1,1)},i.prototype.resize=function(){},i.prototype.getHit=function(){this.typeName==n.CollideHitSpr.SPIKE&&Constants.MAIN_STATE.loseLife()},i.prototype.update=function(){},i}(Phaser.Sprite);t.SPIKE="heart";t.PLATFORM="pumpkins";n.CollideSpikes=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t,i,r){var u=n.call(this,t,i,r,"tile",0)||this;return u.anchor.setTo(.5),t.add.existing(u),t.physics.p2.enable(u),u.outOfBoundsKill=!1,u.resetValues(),u.origPos=new Phaser.Point,u.body.static=!0,u}return __extends(t,n),t.prototype.rememberPos=function(){var n=this.x,t=this.y;this.origPos.x=n;this.origPos.y=t},t.prototype.resetPos=function(){this.x=this.origPos.x;this.y=this.origPos.y},t.prototype.resetValues=function(){this.isActivated=!1;this.isSet=!0;this.collectedStarted=!1;this.revive();this.pivot.set(0,0);this.scale.set(1,1);this.body.setZeroVelocity();this.body.allowGravity=!1;this.body.moves=!1},t.prototype.fall=function(){},t.prototype.resize=function(){},t.prototype.getHit=function(){this.typeName==t.SPIKE&&Constants.MAIN_STATE.loseLife()},t.prototype.rotateFront=function(){Constants.MAIN_STATE.curLvlCntrl.platform2.angle<=180&&(Constants.MAIN_STATE.curLvlCntrl.platform2.angle>0||Constants.MAIN_STATE.curLvlCntrl.platform2.angle<=-160)&&(Constants.MAIN_STATE.curLvlCntrl.platform2.angle-=2.7)},t.prototype.rotateBack=function(){Constants.MAIN_STATE.curLvlCntrl.platform2.angle<180&&(Constants.MAIN_STATE.curLvlCntrl.platform2.angle>=0||Constants.MAIN_STATE.curLvlCntrl.platform2.angle>-5)&&(Constants.MAIN_STATE.curLvlCntrl.platform2.angle+=1.8)},t.prototype.update=function(){this.isActivated&&this==Constants.MAIN_STATE.curLvlCntrl.platform1&&Constants.MAIN_STATE.curLvl==2&&(Constants.MAIN_STATE.player.spr.x+this.width*.3>this.x+this.width&&(Constants.MAIN_STATE.player.overlappingPlatform=!1),Constants.MAIN_STATE.player.overlappingPlatform?this.rotateFront():this.rotateBack(),this.overlap(Constants.MAIN_STATE.player.spr))},t}(Phaser.Sprite);t.SPIKE="heart";t.PLATFORM="pumpkins";n.CollideHitSpr=t}(BaseGame||(BaseGame={})),function(n){var t=function(){function n(n,t){this.trapsActivated=0;this.didVisit2Platform=!1;this.bigBlockMoved=!1;this.game=n;this.state=t}return n.prototype.create=function(){},n.prototype.init=function(){},n.prototype.addGroupsToState=function(){},n.prototype.resetLvl=function(){},n.prototype.destroyLvl=function(){this.spikesGroup.forEach(function(n){n.visible=!1;n.destroy()},this,!1);this.hiddenSpikesGroup.forEach(function(n){n.visible=!1;n.destroy()},this,!1);this.platformSpikesGroup.forEach(function(n){n.visible=!1;n.destroy()},this,!1);this.exitGr.forEach(function(n){n.destroy()},this,!1);this.spikesGroup.removeAll(!0);this.platformGroup.removeAll(!0);this.platformSpikesGroup.removeAll(!0);this.hiddenSpikesGroup.removeAll(!0);console.log("length this.platformGroup"+this.platformGroup.length);this.platformGroup.forEach(function(n){n.visible=!1;n.destroy()},this,!1);this.bigBlock.destroy()},n.prototype.trapsControl=function(){},n.prototype.resize=function(){},n.prototype.update=function(){},n}();n.LevelBase=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r.create(),r.addGroupsToState(),r}return __extends(t,n),t.prototype.create=function(){this.platformGroup=this.game.add.group();this.spikesGroup=this.game.add.group();this.bigBlockGr=this.game.add.group();this.hiddenSpikesGroup=this.game.add.group();this.platformSpikesGroup=this.game.add.group();this.exitGr=this.game.add.group()},t.prototype.addGroupsToState=function(){this.state.scaleGroup.add(this.platformGroup);this.state.scaleGroup.add(this.spikesGroup);this.state.scaleGroup.add(this.bigBlockGr);this.state.scaleGroup.add(this.hiddenSpikesGroup);this.state.scaleGroup.add(this.platformSpikesGroup);this.state.scaleGroup.add(this.exitGr)},t.prototype.init=function(){var t,i,n,r;for(this.spikesHidden=this.hiddenSpikesGroup.getFirstAlive(),this.spikesHidden.origPos.x=this.spikesHidden.x,this.spikesHidden.origPos.y=this.spikesHidden.y,this.spikesOnPlatform=this.platformSpikesGroup.getFirstAlive(),this.spikesOnPlatform.origPos.x=this.spikesOnPlatform.x,this.spikesOnPlatform.origPos.y=this.spikesOnPlatform.y,n=0;n<this.platformGroup.length;n++)t=this.platformGroup.getAt(n),n==0?(this.platform1=t,this.platform1.addChild(this.spikesOnPlatform),this.spikesOnPlatform.x=-this.spikesOnPlatform.width*.5,this.spikesOnPlatform.y=-this.spikesOnPlatform.height*1.5):n==1?this.platform2=t:n==2&&(this.platform3=t),t.rememberPos();for(i=this.game.add.group(),this.state.map.createFromObjects("ovrlpZone",4,"tileEmpt",0,!0,!1,i,Phaser.Sprite),n=0;n<i.length;n++)r=i.getAt(n),n==0?this.endZone=r:n==1&&(this.startZone=r),this.game.physics.enable(i);this.state.scaleGroup.add(this.endZone);this.state.scaleGroup.add(this.startZone);this.bigBlock=this.bigBlockGr.getFirstAlive();this.originalBigBlockPos=new Phaser.Point;this.originalBigBlockPos.x=this.bigBlock.x;this.originalBigBlockPos.y=this.bigBlock.y;this.bigBlock.scale.set(1,1);this.bigBlock.anchor.set(0,0);this.bigBlock.rotation=0;this.changeVisibleHiddenSpikes(!1);this.changeVisiblePlarformSpikes(!1);this.game.physics.enable(this.platformGroup);this.game.physics.enable(this.bigBlockGr);this.state.scaleGroup.add(this.platformGroup)},t.prototype.resetLvl=function(){this.thirdStepTimer!=null&&(this.thirdStepTimer.stop(),this.thirdStepTimer=null);this.bigBlockMoved=!1;this.bigBlock.x=this.originalBigBlockPos.x;this.bigBlock.y=this.originalBigBlockPos.y;this.bigBlock.rotation=0;this.bigBlock.body.velocity.y=0;this.spikesOnPlatform!=null&&this.spikesOnPlatform.body!=null&&(this.spikesOnPlatform.body.velocity.y=0);this.spikesHidden!=null&&this.spikesHidden.body!=null&&(this.spikesHidden.body.velocity.y=0,this.spikesHidden.resetPos());this.changeVisibleHiddenSpikes(!1);this.changeVisiblePlarformSpikes(!1);this.platformGroup.forEach(function(n){n.resetPos();n.resetValues()},this,!1)},t.prototype.destroyLvl=function(){n.prototype.destroyLvl.call(this);this.startZone.destroy();this.endZone.destroy()},t.prototype.hiddenSpikesFollowPlayer=function(){this.spikesHidden!=null&&this.state.player.spr.x>this.endZone.x+this.endZone.width-30&&this.state.player.spr.x<this.game.width*.91&&(this.spikesHidden.x=this.state.player.spr.x)},t.prototype.changeVisiblePlarformSpikes=function(n){this.spikesOnPlatform!=null&&(this.spikesOnPlatform.visible=n)},t.prototype.changeVisibleHiddenSpikes=function(n){this.hiddenSpikesGroup.forEach(function(t){t.visible=n},this,!1)},t.prototype.bigBlockFall=function(){var n=this.bigBlockGr.getFirstAlive();n.body.moves=!0;n.body.velocity.y=700},t.prototype.resetPlatfromTween=function(){typeof this.platform2!="undefined"&&typeof this.platform2.tween!="undefined"&&this.platform2.tween!=null&&(this.platform2.tween=null)},t.prototype.launch1PlatformTo2=function(){if(this.platform1.isSet){this.platform1.isSet=!1;this.platform1.body.moves=!0;this.platform1.body.immovable=!1;this.platform1.body.velocity.y=-300;this.platform1.body.velocity.x=-300;this.platform1.body.allowGravity=!0;this.platform1.body.maxVelocity.y=1500;this.platform1.body.acceleration.y=1500;var n=this.game.time.create(!0);n.repeat(700,1,function(){this.platform2.fall();this.launch1PlatformTo3()},this);n.start()}},t.prototype.launch1PlatformTo3=function(){this.platform1.body.moves=!0;this.platform1.body.immovable=!1;this.platform1.body.velocity.y=-300;this.platform1.body.velocity.x=-300;this.platform1.body.allowGravity=!0;this.platform1.body.maxVelocity.y=1500;this.platform1.body.acceleration.y=1500;this.thirdStepTimer=this.game.time.create(!0);this.thirdStepTimer.repeat(700,1,function(){this.platform3.fall()},this);this.thirdStepTimer.start()},t.prototype.trapsControl=function(){this.state.player.spr.body.x>this.endZone.body.x-30&&this.changeVisibleHiddenSpikes(!0);this.didVisit2Platform&&this.state.player.spr.body.x<this.startZone.body.x&&this.state.player.spr.body.y<this.endZone.body.y+500&&this.bigBlockFall();this.state.player.spr.body.x>this.platform1.body.x&&this.state.player.spr.body.x<this.platform1.body.x+this.platform1.body.width&&this.changeVisiblePlarformSpikes(!0);this.spikesHidden.visible&&this.state.player.spr.body.x>this.endZone.body.x-30&&this.hiddenSpikesFollowPlayer()},t.prototype.resize=function(){n.prototype.resize.call(this)},t.prototype.update=function(){},t}(n.LevelBase);n.Level0=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t){var i=n.call(this,t)||this;return i.game=t,i.hasCrown=!1,i.setNoMoveTimer(),i.needFramesPass=0,i.lastCoords=new Phaser.Point,i.sentSpeedZero=!1,i.lastSentPt=new Phaser.Point,i.lastSentPt.x=-999,i.lastSentPt.y=-999,i.counter=0,i.score=0,i.damage=10,i.killScore=0,i.decreaseSideSpeed=1.5,i.btnsHeld=!1,i.direction=1,i.moveValue=320,i.isShowingDeathAnim=!1,i.killerNameID="",i}return __extends(t,n),t.prototype.makeSprsForAttack=function(){this.swordSpr=this.game.add.sprite(0,0,"sword",0);this.swordSpr.anchor.setTo(.1,.5);this.swordSpr.rotation=0;this.hitLineOuterSpr=this.game.add.sprite(0,0,"hitLineOuter",0);this.hitLineOuterSpr.anchor.setTo(.5);this.hitLineOuterSpr.rotation=0;this.swordSpr.visible=this.hitLineOuterSpr.visible=!1;this.add(this.hitLineOuterSpr);this.add(this.swordSpr)},t.prototype.checkIfCanJump=function(){for(var n,i,u=p2.vec2.fromValues(0,1),r=!1,t=0;t<this.game.physics.p2.world.narrowphase.contactEquations.length;t++)n=this.game.physics.p2.world.narrowphase.contactEquations[t],(n.bodyA===this.spr.body.data||n.bodyB===this.spr.body.data)&&(i=p2.vec2.dot(n.normalA,u),n.bodyA===this.spr.body.data&&(i*=-1),i>.5&&(r=!0));return r},t.prototype.destroy=function(){n.prototype.destroy.call(this);typeof this.spr!="undefined"&&this.spr.destroy();typeof this.barSpr!="undefined"&&this.barSpr.destroy();typeof this.nameTextSpr!="undefined"&&this.nameTextSpr.destroy()},t.prototype.stop=function(){},t.prototype.renewUsualPhysics=function(){typeof this.spr!="undefined"&&this.spr!=null&&typeof this.spr.body!="undefined"&&this.spr.body!=null&&(this.spr.physicsEnabled=!0,this.spr.body.fixedRotation=!0,this.spr.body.rotation=0,this.spr.rotation=0)},t.prototype.addSprs=function(n,t,i){this.add(n);this.makeSprsForAttack();this.add(t);this.add(i);this.spr=n;this.barSpr=t;this.nameTextSpr=i;this.barSpr.setXY(n.x,n.y-20)},t.prototype.flySideTween=function(){this.stop();this.isDead=!0;console.log("fly side");this.fall();var n=this.game.add.tween(this).to({rotation:-10,y:this.spr.y-100,x:this.spr.x-100},400,Phaser.Easing.Linear.None,!0,0);n.onComplete.add(function(){console.log("ended scale");Constants.MAIN_STATE.resetPlayerPos();this.stop();this.renewUsualPhysics();this.firstSet=!1},this)},t.prototype.moveLeft=function(){this.game.time.now>this.noMoveSideTimer&&typeof Constants.MAIN_STATE.player!="undefined"&&typeof Constants.MAIN_STATE.player.spr.body!="undefined"&&typeof Constants.MAIN_STATE!="undefined"?(Constants.MAIN_STATE.player.spr.body.moveLeft(this.moveValue),Constants.MAIN_STATE.player.renewUsualPhysics(),Constants.MAIN_STATE.player.spr.animations.play("walk"),Constants.MAIN_STATE.player.spr.scale.x>0&&(Constants.MAIN_STATE.player.spr.scale.x=-1,Constants.MAIN_STATE.player.direction=-1)):console.log("smth wrong while going left")},t.prototype.moveRight=function(){this.game.time.now>this.noMoveSideTimer&&typeof Constants.MAIN_STATE.player!="undefined"&&typeof Constants.MAIN_STATE.player.spr.body!="undefined"&&typeof Constants.MAIN_STATE!="undefined"&&(Constants.MAIN_STATE.player.spr.body.moveRight(this.moveValue),Constants.MAIN_STATE.player.renewUsualPhysics(),Constants.MAIN_STATE.player.spr.animations.play("walk"),Constants.MAIN_STATE.player.spr.scale.x<0&&(Constants.MAIN_STATE.player.spr.scale.x=1,Constants.MAIN_STATE.player.direction=1))},t.prototype.jump=function(){this.spr.body!="undefined"&&this.checkIfCanJump()&&typeof Constants.MAIN_STATE!="undefined"&&this.game.time.now>Constants.MAIN_STATE.jumpTimer&&(Constants.MUSIC_ON&&Constants.MAIN_STATE.jumpSnd.play(),Constants.MAIN_STATE.player.spr.body.velocity.y=-480,Constants.MAIN_STATE.player.renewUsualPhysics(),Constants.MAIN_STATE.jumpTimer=Constants.MAIN_STATE.player.game.time.now+750,Constants.MAIN_STATE.player.spr.animations.play("jump"),this.overlappingPlatform&&(this.stopCurrentOverlap(),this.overlappingPlatform=!1),this.emitPos())},t.prototype.setNoMoveTimer=function(){this.noMoveSideTimer=this.game.time.now+550},t.prototype.stopCurrentOverlap=function(){Constants.MAIN_STATE.curLvl==2},t.prototype.fall=function(){this.spr.animations.frame=0;this.spr.body.velocity.y=200;this.spr.body.velocity.x=0;this.setNoMoveTimer();this.stopMove()},t.prototype.emitPos=function(){var n=1;this.spr.scale.x<0&&(n=-1)},t.prototype.stopMove=function(){this.spr.body.velocity.x=0},t.prototype.controlMove=function(){(this.stopMove(),this.isShowingDeathAnim)||(this.holdRight?(this.moveRight(),this.btnsHeld=!0):this.holdLeft?(this.moveLeft(),this.btnsHeld=!0):this.btnsHeld=!1,this.holdUp&&this.jump(),this.game.input.keyboard.isDown(Phaser.Keyboard.ENTER)&&Constants.MAIN_STATE.tryAttack(),(this.game.input.keyboard.isDown(Phaser.Keyboard.UP)||this.game.input.keyboard.isDown(Phaser.Keyboard.W)||this.game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR))&&this.jump(),this.game.input.keyboard.isDown(Phaser.Keyboard.LEFT)||this.game.input.keyboard.isDown(Phaser.Keyboard.A)?this.moveLeft():this.game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)||this.game.input.keyboard.isDown(Phaser.Keyboard.D)?this.moveRight():(this.gradualStopX(),this.holdRight||this.holdLeft||this.holdUp||(this.spr.animations.frame=this.spr.body.velocity.y<0&&!this.checkIfCanJump()?4:0)),this.spr.body.velocity.x==0?this.sentSpeedZero||(this.postPosition(),this.sentSpeedZero=!0):this.sentSpeedZero=!1)},t.prototype.getMoved=function(n,t){console.log("get moved");this.spr.body.velocity.x=n;this.spr.body.velocity.y=t},t.prototype.doPost=function(){var n;this.counter=0;this.lastSentPt.x=this.spr.body.x;this.lastSentPt.y=this.spr.body.y;n=1;this.spr.scale.x<0&&(n=-1);var t=45,i=Math.floor(this.spr.body.x/t),r=Math.floor(this.spr.body.y/t);window.game.socket.emit("move",{auth:Constants.MAIN_STATE.authInfo,coords:{x:i,y:r,xabs:Math.floor(this.spr.body.x),yabs:Math.floor(this.spr.body.y)},direction:n,speed:{x:this.spr.body.velocity.x}})},t.prototype.postPosition=function(){(Math.abs(this.lastSentPt.x-this.spr.body.x)>1||Math.abs(this.lastSentPt.y-this.spr.body.y)>1)&&(this.counter>this.needFramesPass&&this.game.time.physicsElapsed>.016?this.doPost():this.counter++)},t.prototype.gradualStopX=function(){Math.abs(this.spr.body.velocity.x)>10?this.spr.body.velocity.x>0?this.spr.body.velocity.x-=this.decreaseSideSpeed:this.spr.body.velocity.x+=this.decreaseSideSpeed:this.spr.body.velocity.x=0},t.prototype.resetAtStart=function(){this.health=10;console.log("reset and set hp in client")},t.prototype.showDeath=function(){if(typeof this.spr!="undefined"&&this.spr!=null&&typeof this.spr.body!="undefined"&&this.spr.body!=null){this.health=0;console.log("show death "+this.name);this.barSpr.updateValues(0,this.healthMax);this.spr.body.rotation=0;var n=this.game.add.tween(this.spr.body).to({rotation:-10,y:this.spr.body.y-100,x:this.spr.body.x-100},400,Phaser.Easing.Linear.None,!0,0);n.onComplete.add(function(){this.stop();this.renewUsualPhysics();this.isShowingDeathAnim=!1;this==Constants.MAIN_STATE.player?Constants.MAIN_STATE.endGame():this.destroy()},this);this.spr.physicsEnabled=!1;this.spr.body.fixedRotation=!1;this.isShowingDeathAnim=!0}},t.prototype.showAttack=function(){var i,n,t;this.isAttacking||this.game!=null&&(Constants.MUSIC_ON&&Constants.MAIN_STATE.swooshSnd.play(),console.log("Attacking. Name: "+this.nameID),this.isAttacking=!0,this.swordSpr.visible=this.hitLineOuterSpr.visible=!0,this.hitLineOuterSpr.alpha=0,this.swordSpr.angle=0,i=this.game.add.tween(this.hitLineOuterSpr).to({alpha:1},200,Phaser.Easing.Linear.None,!0,0),this.direction==1?(this.swordSpr.angle=-120,n=this.game.add.tween(this.swordSpr).to({angle:120},500,Phaser.Easing.Linear.None,!0,0)):(this.swordSpr.angle=0,n=this.game.add.tween(this.swordSpr).to({angle:-240},500,Phaser.Easing.Linear.None,!0,0)),t=this.game.add.tween(this.spr.scale).to({x:this.direction*1.02,y:1.02},300,Phaser.Easing.Linear.None,!0,0),t.onComplete.add(function(){this.scaleBack()},this))},t.prototype.showHurt=function(){this.spr.alpha=0;var n=this.game.add.tween(this.spr).to({alpha:1},200,Phaser.Easing.Linear.None,!0,0,5,!0);n.onComplete.add(function(){this.spr.alpha=1},this)},t.prototype.scaleBack=function(){if(this.game!=null){var n=this.game.add.tween(this.spr.scale).to({x:this.direction*1,y:1},300,Phaser.Easing.Linear.None,!0,0),t=this.game.add.tween(this.hitLineOuterSpr).to({alpha:0},200,Phaser.Easing.Linear.None,!0,200);n.onComplete.add(function(){this.swordSpr.visible=!1;this.isAttacking=!1},this)}},t.prototype.updateBarAndText=function(){typeof this.spr!="undefined"&&this.spr!=null&&typeof this.spr.body!="undefined"&&this.spr.body!=null&&(this.barSpr.setXY(this.spr.body.x-this.barSpr.width*.5,this.spr.body.y-this.spr.height),this.nameTextSpr.x=this.spr.body.x,this.nameTextSpr.y=this.spr.body.y-this.spr.height-30,this.hasCrown&&(Constants.MAIN_STATE.crownSpr.x=this.spr.body.x,Constants.MAIN_STATE.crownSpr.y=this.spr.body.y-this.spr.height-50),this.nameTextSpr.text=""+this.nameID,this.barSpr.updateValues(this.health,this.healthMax),typeof this.appearText!="undefined"&&this.appearText!=null&&(this.appearText.x=this.spr.body.x,this.appearText.y=this.spr.body.y-this.spr.height-90),this.swordSpr.visible&&(this.swordSpr.x=this.direction==1?this.spr.body.x+20:this.spr.body.x-20,this.swordSpr.y=this.spr.body.y-this.spr.height*.5+20,this.hitLineOuterSpr.x=this.spr.body.x,this.hitLineOuterSpr.y=this.spr.body.y))},t.prototype.update=function(){var t=this;if((n.prototype.update.call(this),typeof this.spr!="undefined"&&this.spr!=null&&typeof this.spr.body!="undefined"&&this.spr.body!=null)&&(this.spr.x<0&&(this.spr.x=0),this.updateBarAndText(),typeof Constants.MAIN_STATE!="undefined"&&typeof Constants.MAIN_STATE.curLvlCntrl!="undefined")){if(Constants.MAIN_STATE.loseScreenSpr.visible)return;this==Constants.MAIN_STATE.player&&(typeof Constants.MAIN_STATE.curLvlCntrl.spikesGroup!="undefined"&&Constants.MAIN_STATE.curLvlCntrl.spikesGroup.forEach(function(n){Utils.overlapsRects(t.spr.body.x,t.spr.body.y,t.spr.width*t.spr.scale.x,t.spr.height*t.spr.scale.y,n.x,n.y,n.width*n.scale.x,n.height*n.scale.y,2)&&Constants.MAIN_STATE.loseLife()},this,!1),typeof Constants.MAIN_STATE.coinGroup!="undefined"&&Constants.MAIN_STATE.coinGroup.forEach(function(n){Utils.overlapsRects(t.spr.body.x,t.spr.body.y,t.spr.width*t.spr.scale.x,t.spr.height*t.spr.scale.y,n.x,n.y,n.width*n.scale.x,n.height*n.scale.y)&&!t.isShowingDeathAnim&&n.visible==!0&&(Constants.MUSIC_ON&&Constants.MAIN_STATE.collectSnd.play(),n.visible=!1,console.log("ovrlp coin"))},this,!1),typeof Constants.MAIN_STATE.walletGroup!="undefined"&&Constants.MAIN_STATE.walletGroup.forEach(function(n){t.spr.overlap(n)&&!t.isShowingDeathAnim&&t.health>0&&n.visible==!0&&(Constants.MUSIC_ON&&Constants.MAIN_STATE.collectSnd.play(),n.visible=!1,console.log("ovrlp wallet"))},this,!1),typeof Constants.MAIN_STATE.coinGroup!="undefined"&&Constants.MAIN_STATE.heartGroup.forEach(function(n){Utils.overlapsRects(t.spr.body.x,t.spr.body.y,t.spr.width*t.spr.scale.x,t.spr.height*t.spr.scale.y,n.x,n.y,n.width*n.scale.x,n.height*n.scale.y)&&!t.isShowingDeathAnim&&n.visible==!0&&t.health<t.healthMax&&(Constants.MUSIC_ON&&Constants.MAIN_STATE.collectSnd.play(),n.visible=!1,console.log("ovrlp heart"))},this,!1));this==Constants.MAIN_STATE.player?(this.controlMove(),Constants.MAIN_STATE.needToResetInfoFromServer==!1&&this.postPosition()):this.gradualStopX()}},t}(Phaser.Group);n.PlayerCtrl=t}(BaseGame||(BaseGame={})),function(n){function t(){this.turnOn=!0}function i(t){n.scaleX=t.width/Constants.GAME_WIDTH;n.scaleY=t.height/Constants.GAME_HEIGHT;n.scaleMin=Math.min(n.scaleX,n.scaleY);n.scaleXUse=n.scaleX;n.scaleYUse=n.scaleY;window.scaleXUse=n.scaleXUse;window.scaleYUse=n.scaleYUse}function r(){this.turnOn=!1}n.showTurn=t;n.renew=i;n.hideTurn=r}(ScaleControl||(ScaleControl={})),function(n){var t=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r.create(),r.addGroupsToState(),r}return __extends(t,n),t.prototype.create=function(){this.platformGroup=this.game.add.group();this.spikesGroup=this.game.add.group();this.bigBlockGr=this.game.add.group();this.hiddenSpikesGroup=this.game.add.group();this.platformSpikesGroup=this.game.add.group();this.exitGr=this.game.add.group()},t.prototype.init=function(){console.log("call init lvl 1");this.spikesGroup.forEach(function(n){n.destroy()},this,!1);this.spikesGroup.removeAll(!0);this.spikesGroup.forEach(function(n){console.log("there is a spike");n.destroy()},this,!1)},t.prototype.resetLvl=function(){},t.prototype.destroyLvl=function(){this.spikesGroup.forEach(function(n){n.visible=!1;n.destroy()},this,!1);this.spikesGroup.removeAll(!0);this.spikesGroup.destroy();this.platformGroup.destroy();this.bigBlockGr.destroy();this.hiddenSpikesGroup.destroy();this.platformSpikesGroup.destroy();this.exitGr.destroy()},t.prototype.addGroupsToState=function(){this.state.scaleGroup.add(this.spikesGroup)},t.prototype.resize=function(){n.prototype.resize.call(this)},t.prototype.update=function(){},t}(n.LevelBase);n.Level1=t}(BaseGame||(BaseGame={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.jumpTimer=0,n.livesLeft=10,n.livesMax=1,n.noHitTimer=0,n.curLvl=0,n.maxLvls=3,n.tileSize=45,n.attackAllowedTimer=0,n}return __extends(i,t),i.prototype.create=function(){this.givenLoginID="";this.allFps=0;this.countedFrames=0;Constants.MAIN_STATE=this;window.continueAfterDeath=function(){Constants.MAIN_STATE.continueAfterDeath()};this.physics.startSystem(Phaser.Physics.P2JS);this.physics.p2.restitution=.8;this.background=this.add.sprite(0,0,"back");this.music=this.add.audio("music",1,!1);this.player=new n.PlayerCtrl(this.game);this.jumpSnd=this.game.add.audio("jumpSnd");this.hitSnd=this.game.add.audio("hurtSnd");this.collectSnd=this.game.add.audio("pickupSnd");this.swooshSnd=this.game.add.audio("swooshSnd");this.underMapScale=this.game.add.group();this.backGroup=this.game.add.group();this.scaleGroup=this.game.add.group();this.hudGroup=this.game.add.group();this.enemiesGroup=this.game.add.group();this.heartGroup=this.game.add.group();this.coinGroup=this.game.add.group();this.walletGroup=this.game.add.group();this.gameOverText=this.game.add.text(this.game.world.centerX,30,"1",{font:"Pixel Cyr",fill:"FFffff",align:"center",wordWrap:!0,wordWrapWidth:450});this.gameOverText.anchor.setTo(.5,0);this.gameOverText.fontSize=60;this.gameOverText.stroke="#000";this.gameOverText.strokeThickness=16;this.gameOverText.colors=["#FFffff"];this.gameOverText.stroke="#000";this.gameOverText.strokeThickness=2;this.gameOverText.x=this.game.world.width*.5;this.gameOverText.y=this.game.world.height*.6;this.gameOverText.text="You was killed by";this.gameOverText.visible=!1;this.game.time.advancedTiming=!0;this.scaleGroup.add(this.enemiesGroup);this.scaleGroup.add(this.heartGroup);this.scaleGroup.add(this.coinGroup);this.scaleGroup.add(this.walletGroup);this.scaleGroup.add(this.player);this.crownSpr=this.add.sprite(0,0,"crown");this.crownSpr.anchor.set(.5);this.hudGroup.add(this.crownSpr);this.leaderBoard=new n.LeaderBoardGr(this.game);this.game.add.existing(this.leaderBoard);this.hudGroup.add(this.leaderBoard);this.upgrGr=new n.UpgradeGroup(this.game);this.game.add.existing(this.upgrGr);this.hudGroup.add(this.upgrGr);this.game.physics.p2.setImpactEvents(!0);this.game.input.addPointer();this.game.input.maxPointers=3;window.loadedFirst=!0;this.upKey=this.game.input.keyboard.addKey(Phaser.Keyboard.ONE);this.upKey2=this.game.input.keyboard.addKey(Phaser.Keyboard.TWO);this.game.input.keyboard.onUpCallback=function(n){(n.keyCode==Phaser.Keyboard.LEFT||n.keyCode==Phaser.Keyboard.RIGHT||n.keyCode==Phaser.Keyboard.D||n.keyCode==Phaser.Keyboard.A)&&Constants.MAIN_STATE.player!=null&&Constants.MAIN_STATE.player.spr!=null&&Constants.MAIN_STATE.player.stopMove()};this.fpsText=new Phaser.Text(this.game,5,this.game.height-30,"FPS: ",{fill:"#EEEEEE",align:"left"});this.fpsText.fontSize=20;this.hudGroup.add(this.fpsText);this.fpsText.fixedToCamera=!0;ScaleControl.renew(this.game);this.game.input.onDown.add(this.checkReleased,this);Constants.MAIN_STATE=this;window.$.ajaxSetup({crossDomain:!0,xhrFields:{withCredentials:!0}});Constants.PLAYER_NAME==""||Constants.PLAYER_NAME.length==0;window.game.socket=window.io("https://ca1.trapz.io",{transports:["websocket"]});this.startTimePing=new Date;window.game.socket.on("connect",function(){Constants.MAIN_STATE.endTimePing=new Date});Constants.PLAYER_NAME=window.inputName;window.game.socket.emit("login",Constants.PLAYER_NAME);window.$("#loading").show();this.doLogin();this.loseScreenSpr=this.add.sprite(0,0,"gameOver");this.loseScreenSpr.visible=!1;this.loseScreenSpr.fixedToCamera=!0;this.gameOverText.fixedToCamera=!0;this.playAgainBtn=this.game.add.button(this.game.width*.5,this.game.height*.8,"tile",function(){},this,2,1,0);this.playAgainBtn.anchor.set(.5,.5);this.playAgainBtn.fixedToCamera=!0;this.musicBtn=this.game.add.button(this.game.width-50,50,"onMusicBtn",function(){this.switchMusic()},this,2,1,0);this.musicBtn.anchor.set(.5,.5);this.musicBtn.fixedToCamera=!0;this.playAgainBtn.events.onInputUp.add(function(){},this);this.playAgainBtn.visible=!1;this.gameOverText.visible=!1;this.loseScreenSpr.visible=!1;this.tileSize=45;this.curPlayTime=0},i.prototype.doLogin=function(){window.game.socket.on("login",function(n){var t,i;if(Constants.MAIN_STATE.player.killScore=0,Constants.MAIN_STATE.player.score=0,console.log("data given in login: "+n),window.$("#loading").hide(),Constants.MAIN_STATE.authInfo=n.user.auth,Constants.MAIN_STATE.givenLoginID==null||typeof Constants.MAIN_STATE.givenLoginID=="undefined"||Constants.MAIN_STATE.givenLoginID.length==0){Constants.MAIN_STATE.callOnceCreate();Constants.MAIN_STATE.givenLoginID=n.user.id;window.game.socket.on("update",function(n){Constants.MAIN_STATE.parseServerData(n)});console.log("NEW ID set "+Constants.MAIN_STATE.givenLoginID);window.document.cookie="id="+Constants.MAIN_STATE.givenLoginID+"; expires=Fri, 31 Dec 2024 23:59:59 GMT";t=Constants.MAIN_STATE.endTimePing.getTime()-Constants.MAIN_STATE.startTimePing.getTime();window.game.socket.emit("stats",{id:Constants.MAIN_STATE.givenLoginID,connecttime:t});window.game.socket.on("wallet",function(n){n.user==Constants.MAIN_STATE.player.nameID?(console.log("found wallet! "),n.walletUser==Constants.MAIN_STATE.player.nameID?Constants.MAIN_STATE.addText(Constants.MAIN_STATE.player.spr.body.x,Constants.MAIN_STATE.player.spr.body.y-Constants.MAIN_STATE.player.spr.height-120,"You've recovered your money: "+n.scoreGrabbed+" gold!",Constants.MAIN_STATE.player,!1,3500):Constants.MAIN_STATE.addText(Constants.MAIN_STATE.player.spr.body.x,Constants.MAIN_STATE.player.spr.body.y-Constants.MAIN_STATE.player.spr.height-120,"You've got "+n.walletUser+"'s money: "+n.scoreGrabbed+" gold!",Constants.MAIN_STATE.player,!1,3500)):n.walletUser==Constants.MAIN_STATE.player.nameID&&Constants.MAIN_STATE.addText(Constants.MAIN_STATE.player.spr.body.x,Constants.MAIN_STATE.player.spr.body.y-Constants.MAIN_STATE.player.spr.height-120,n.user+" has found your lost purse:"+n.scoreGrabbed+" gold!",Constants.MAIN_STATE.player,!1,3500)});window.game.socket.on("death",function(n){var t,i;if(n instanceof Array)for(t=0;t<n.length;t++)n[t].by=="user"?typeof n[t].killedUser!="undefined"&&n[t].killedUser!=null&&(n[t].killedUser==Constants.MAIN_STATE.player.nameID?(Constants.MAIN_STATE.player.killerNameID=n[t].user,Constants.MAIN_STATE.player.isShowingDeathAnim||Constants.MAIN_STATE.player.showDeath()):n[t].user==Constants.MAIN_STATE.player.nameID&&(typeof Constants.MAIN_STATE.player.appearText=="undefined"||Constants.MAIN_STATE.player.appearText==null)&&(n[t].scoreGrabbed!=0?Constants.MAIN_STATE.addText(Constants.MAIN_STATE.player.spr.body.x,Constants.MAIN_STATE.player.spr.body.y-Constants.MAIN_STATE.player.spr.height-130,"Killed "+n[t].killedUser+" and got "+n[t].scoreGrabbed+" gold",Constants.MAIN_STATE.player):Constants.MAIN_STATE.addText(Constants.MAIN_STATE.player.spr.body.x,Constants.MAIN_STATE.player.spr.body.y-Constants.MAIN_STATE.player.spr.height-130,"Killed "+n[t].killedUser,Constants.MAIN_STATE.player),Constants.MAIN_STATE.player.killScore++),n[t].killedUser==Constants.MAIN_STATE.player.nameID||(i=Constants.MAIN_STATE.findplayerbyid(n[t].killedUser),typeof i!="undefined"&&i!=null&&i.showDeath())):n[t].by=="spike"&&(n[t].killedUser==Constants.MAIN_STATE.player.nameID?(Constants.MAIN_STATE.player.killerNameID="",window.killUser="",Constants.MAIN_STATE.player.isShowingDeathAnim||Constants.MAIN_STATE.player.showDeath()):(i=Constants.MAIN_STATE.findplayerbyid(n[t].killedUser),typeof i!="undefined"&&i!=null&&i.showDeath()))})}i=JSON.stringify(n.levelMap);console.log("COOKIE: "+window.document.cookie);(typeof Constants.PLAYER_NAME=="undefined"||Constants.PLAYER_NAME==""||Constants.PLAYER_NAME.length==0||typeof n.user.name!="undefined"&&n.user.name!=null&&n.user.name!=Constants.PLAYER_NAME)&&(Constants.PLAYER_NAME=n.user.name);window.game.socket.on("disconnect",function(){window.game.socket.emit("reconnect",{auth:Constants.MAIN_STATE.authInfo})});window.game.socket.on("reconnected",function(){console.log("reconnected")});window.game.socket.on("login_required",function(){console.log("login_required");Constants.MAIN_STATE.player.isShowingDeathAnim||Constants.MAIN_STATE.endGame()});Constants.MAIN_STATE.load.tilemap("lvlLoad",null,i,Phaser.Tilemap.TILED_JSON).onLoadComplete.addOnce(function(){console.log("NEW MAP completed loading");Constants.MAIN_STATE.loadLvl()});Constants.MAIN_STATE.loadLvl();Constants.MAIN_STATE.resize();Constants.MAIN_STATE.resizeBtns();Constants.MAIN_STATE.makeEnemyPlayer(n,!0);Constants.MAIN_STATE.needToResetInfoFromServer=!0;Constants.MAIN_STATE.player.doPost();Constants.MAIN_STATE.updateEnemiesArray(n.players);Constants.MAIN_STATE.updateHeartsArray(n.hearts);Constants.MAIN_STATE.updateCoinsArray(n.coins);typeof n.wallets!="undefined"&&Constants.MAIN_STATE.updateWalletsArray(n.wallets);typeof n.leaderboard!="undefined"&&n.leaderboard!=null&&(Constants.MAIN_STATE.leaderBoard.renewText(n.leaderboard),Constants.MAIN_STATE.checkCrownOwner(n.leaderboard),Constants.MAIN_STATE.lastLeaderboard=n.leaderboard);window.game.input.onDown.add(Constants.MAIN_STATE.checkReleased,Constants.MAIN_STATE);console.log("ONLINE players: "+n.players.length);Constants.MAIN_STATE.upgrGr.renewInfoText();Constants.MAIN_STATE.upgrGr.updateBtnTexts();Constants.MAIN_STATE.upgrGr.checkVisibility();Constants.MUSIC_ON=Utils.loadSave("music");Constants.MAIN_STATE.checkMusicBtn()})},i.prototype.callOnceCreate=function(){console.log("create once called");Constants.MAIN_STATE.upgrGr.createTexts();Constants.MAIN_STATE.upgrGr.renewInfoText();Constants.MAIN_STATE.upgrGr.updateBtnTexts();Constants.MAIN_STATE.upgrGr.checkVisibility();Constants.MAIN_STATE.leaderBoard.createTexts()},i.prototype.checkMusicBtn=function(){Constants.MUSIC_ON?this.musicBtn.loadTexture("onMusicBtn"):this.musicBtn.loadTexture("offMusicBtn")},i.prototype.switchMusic=function(){Constants.MUSIC_ON=!Constants.MUSIC_ON;this.checkMusicBtn();Utils.save("music",Constants.MUSIC_ON)},i.prototype.findEnemyWithThisBody=function(n){for(var t=0;t<window.game.enemies.length;t++)if(window.game.enemies[t].spr.body===n)return window.game.enemies[t]},i.prototype.objsHitProcess=function(n,t){if(console.log("hit obj"),n.sprite!=null&&t.sprite!=null&&n.sprite.name=="player"&&t.sprite.name=="enemy"){console.log("angle  player tile"+Utils.angleBetweenSprs(n,t));console.log("angle tile player "+Utils.angleBetweenSprs(t,n));var i=Utils.moveTowardsObject(t,n,250),r=this.findEnemyWithThisBody(t);return this.player.getMoved(i.x,i.y),!1}return!0},i.prototype.hitEnemy=function(){},i.prototype.seeServerInfo=function(){},i.prototype.showEnemiesInfo=function(){for(var t,n=0;n<window.game.enemies.length;n++)t=window.game.enemies[n],console.log("POS x: "+t.spr.body.x+". Y: "+t.spr.body.y)},i.prototype.resetGame=function(){console.log("asked for reset")},i.prototype.hideGameOver=function(){this.loseScreenSpr.visible=!1;this.playAgainBtn.visible=!1;this.gameOverText.visible=!1},i.prototype.continueAfterDeath=function(){console.log("continue after death");this.hideGameOver();window.hideGameOver();this.player.destroy();this.destroLvl();window.$("#loading").show();console.log("ask for login");Constants.MAIN_STATE.curPlayTime=0;Constants.PLAYER_NAME=window.inputName;window.game.socket.emit("login",Constants.PLAYER_NAME);this.needToResetInfoFromServer=!0},i.prototype.checkReleased=function(){this.resizeBtns();this.loseScreenSpr.visible&&window.checkGameOverScreenOn()==!1?this.continueAfterDeath():this.musicBtn.getBounds().contains(this.game.input.x,this.game.input.y)==!1&&(this.upgrGr.heartBtn.visible==!1||this.upgrGr.heartBtn.getBounds().contains(this.game.input.x,this.game.input.y)==!1)&&(this.upgrGr.swordBtn.visible==!1||this.upgrGr.swordBtn.getBounds().contains(this.game.input.x,this.game.input.y)==!1)&&this.tryAttack()},i.prototype.tryAttack=function(){if(this.game.time.now>this.attackAllowedTimer)this.attackAllowedTimer=this.game.time.now+2e3,window.game.socket.emit("attack",{type:"sword",auth:Constants.MAIN_STATE.authInfo}),this.player.showAttack();else return},i.prototype.updateWalletsArray=function(n){var i,e,r,s,f,o,h,t,u;if(n instanceof Array){for(i=n.slice(0,n.length),e=[],t=0;t<window.game.wallets.length;t++){for(r=window.game.wallets[t],s=!1,f=0;f<n.length;f++)r.name==n[f].name&&(o=n[f],r!=null&&(r.x=o.coords.x*Constants.MAIN_STATE.tileSize+Constants.MAIN_STATE.tileSize*.5,r.y=o.coords.y*Constants.MAIN_STATE.tileSize+Constants.MAIN_STATE.tileSize),s=!0,i.splice(i.indexOf(o),1));s||(r.destroy(),e.push(r))}for(t=0;t<e.length;t++)h=window.game.wallets.indexOf(e[t]),window.game.wallets.splice(h,1);for(t=0;t<i.length;t++)u=window.game.add.sprite(i[t].coords.x,i[t].coords.y,"gold",0,this.walletGroup),this.walletGroup.add(u),u.anchor.setTo(.5,1),u.x=i[t].coords.x*Constants.MAIN_STATE.tileSize+Constants.MAIN_STATE.tileSize*.5,u.y=i[t].coords.y*Constants.MAIN_STATE.tileSize+Constants.MAIN_STATE.tileSize,u.name=i[t].name,window.game.wallets.push(u);i=[]}},i.prototype.updateHeartsArray=function(n){var o=45,r,i,s,f,e,t,u;if(n instanceof Array){for(r=n.slice(0,n.length),t=0;t<window.game.hearts.length;t++){for(i=window.game.hearts[t],s=!1,f=0;f<n.length;f++)i.name==n[f].name&&(e=n[f],i!=null&&(i.x=e.x*o+this.tileSize*.5,i.y=e.y*o+this.tileSize*.5),e.show===!1?(i.visible,i.visible=!1):i.visible=!0,s=!0,r.splice(r.indexOf(e),1));s||(console.log("haven't found in a new array name "+i.name+". Kill it"),i.destroy())}for(t=0;t<r.length;t++)u=this.game.add.sprite(r[t].x*o+this.tileSize*.5,r[t].y*o+this.tileSize*.5,"heartSpr"),u.anchor.set(.5),u.name=r[t].name,window.game.hearts.push(u),this.heartGroup.add(u),u.visible=r[t].show===!1?!1:!0;r=[]}},i.prototype.updateCoinsArray=function(n){var i,u,o,f,e,t,r,s;if(n instanceof Array){for(i=n.slice(0,n.length),t=0;t<window.game.coins.length;t++){for(u=window.game.coins[t],o=!1,f=0;f<n.length;f++)u.name==n[f].name&&(e=n[f],u!=null&&(u.x=e.x*this.tileSize+this.tileSize*.5,u.y=e.y*this.tileSize+this.tileSize*.5),o=!0,i.splice(i.indexOf(e),1));o||u.destroy()}for(t=0;t<i.length;t++)r=this.game.add.sprite(i[t].x*this.tileSize,i[t].y*this.tileSize,"coin"),r.x=i[t].x*this.tileSize+this.tileSize*.5,r.y=i[t].y*this.tileSize+this.tileSize*.5,r.name=i[t].name,r.anchor.set(.5),s=this.game.add.tween(r.scale).to({x:r.scale.x*-1,y:1},Phaser.Math.random(1300,2200),Phaser.Easing.Linear.None,!0,Phaser.Math.random(500,2500),-1,!0),window.game.coins.push(r),this.coinGroup.add(r);i=[]}},i.prototype.updateEnemiesArray=function(n){var r,h,f,u,o,e,i;if(typeof n=="undefined"||n==null){console.log("no data passed! for enemies creation");return}if(n instanceof Array){for(r=n.slice(0,n.length),h=[],i=0;i<window.game.enemies.length;i++){var t=window.game.enemies[i],s=!1,c=!1;if(t==null){c=!0;break}for(f=0;f<n.length;f++)if(t.nameID==n[f].user.name&&t.sessionID==n[f].user.session){if(u=n[f],t.spr==null||t.spr.body==null||t.isShowingDeathAnim||(typeof u.character.coords.xabs=="undefined"?(t.spr.body.x=u.character.coords.x*this.tileSize+this.tileSize*.5,t.spr.body.y=u.character.coords.y*this.tileSize+this.tileSize*.5):(t.spr.body.x=u.character.coords.xabs,t.spr.body.y=u.character.coords.yabs)),t.health=u.character.health,t.healthMax=100,t.score=u.user.score,t.updateBarAndText(),Constants.MAIN_STATE.upgrGr.updateBtnTexts(),typeof u.character.swordColor!="undefined")switch(u.character.swordColor){case"white":t.swordSpr.tint=16777215;t.hitLineOuterSpr.tint=16777215;break;case"green":t.swordSpr.tint=65280;t.hitLineOuterSpr.tint=65280;break;case"blue":t.swordSpr.tint=255;t.hitLineOuterSpr.tint=255;break;case"red":t.swordSpr.tint=16711680;t.hitLineOuterSpr.tint=16711680}u.character.speed.x==0?(t.spr.animations.frame=0,t.spr.animations.stop("walk")):t.spr.animations.play("walk");u.character.isAttacking==!0&&t.showAttack();t.spr.scale.x=u.character.direction;u.character.health==0&&t.showDeath();s=!0;o=r.indexOf(u);o!=-1&&(r.splice(o,1),console.log("in copy remove indx "+o))}s||(t.isShowingDeathAnim?console.log("SHOW DEATH ANIM, haven't found in a new array name "+t.nameID):(t.destroy(),console.log("haven't found in a new array name "+t.nameID+". Kill it"),window.game.enemies[i]=null))}for(e=0;e<window.game.enemies.length;)window.game.enemies[e]!=null?e++:window.game.enemies.splice(e,1);for(i=0;i<r.length;i++)if(r[i].user.name!=Constants.MAIN_STATE.player.nameID)this.makeEnemyPlayer(r[i],!1);else{if(this.player.health=r[i].character.health,typeof r[i].user.attack!="undefined"&&(this.player.damage=r[i].user.attack),this.player.healthMax=typeof r[i].user.maxhealth!="undefined"?r[i].user.maxhealth:100,this.player.sessionID=r[i].user.session,this.player.score=r[i].user.score,Constants.MAIN_STATE.upgrGr.renewInfoText(),Constants.MAIN_STATE.upgrGr.checkVisibility(),this.player.updateBarAndText(),typeof r[i].character.swordColor!="undefined")switch(r[i].character.swordColor){case"white":this.player.swordSpr.tint=16777215;this.player.hitLineOuterSpr.tint=16777215;break;case"green":this.player.swordSpr.tint=65280;this.player.hitLineOuterSpr.tint=65280;break;case"blue":this.player.swordSpr.tint=255;this.player.hitLineOuterSpr.tint=255;break;case"red":this.player.swordSpr.tint=16711680;this.player.hitLineOuterSpr.tint=16711680}this.needToResetInfoFromServer&&(this.setSelfCoordsFromServerInfo(r),this.needToResetInfoFromServer=!1)}r=[]}},i.prototype.setSelfCoordsFromServerInfo=function(n){if(this.player.spr!=null&&this.player.spr.body!=null){console.log("BEFORE set coords to player from server X: "+this.player.spr.body.x);for(var t=0;t<n.length;t++)n[t].user.name==Constants.MAIN_STATE.player.nameID&&(this.player.spr.body.x=n[t].character.coords.x*this.tileSize+this.tileSize*.5,this.player.spr.body.y=n[t].character.coords.y*this.tileSize+this.tileSize*.5,this.player.direction=n[t].character.direction,this.player.health=n[t].character.health,this.player.updateBarAndText(),console.log("set coords to player from server X: "+n[t].character.coords.x*this.tileSize))}},i.prototype.parseServerData=function(n){var i=JSON.stringify(n),t=window.jQuery.parseJSON(i);typeof t.players!="undefined"&&t.players!=null&&Constants.MAIN_STATE.updateEnemiesArray(t.players);typeof t.hearts!="undefined"&&t.hearts!=null&&Constants.MAIN_STATE.updateHeartsArray(t.hearts);typeof t.coins!="undefined"&&t.coins!=null&&Constants.MAIN_STATE.updateCoinsArray(t.coins);typeof t.wallets!="undefined"&&t.wallets!=null&&Constants.MAIN_STATE.updateWalletsArray(t.wallets);typeof t.leaderboard!="undefined"&&t.leaderboard!=null&&(Constants.MAIN_STATE.lastLeaderboard=t.leaderboard,Constants.MAIN_STATE.leaderBoard.renewText(t.leaderboard),Constants.MAIN_STATE.checkCrownOwner(t.leaderboard))},i.prototype.checkCrownOwner=function(n){for(var t,i=0;i<n.length;i++)n[i].place==1?n[i].name==Constants.MAIN_STATE.player.nameID?Constants.MAIN_STATE.player.spr!=null&&typeof Constants.MAIN_STATE.player.spr!="undefined"&&typeof Constants.MAIN_STATE.player.spr.body!="undefined"&&Constants.MAIN_STATE.player.spr.body!=null?(this.crownSpr.x=Constants.MAIN_STATE.player.spr.body.x,this.crownSpr.y=Constants.MAIN_STATE.player.spr.body.y-70,Constants.MAIN_STATE.player.hasCrown=!0,this.crownSpr.visible=!0):this.crownSpr.visible=!1:(t=this.findplayerbyid(n[i].name),typeof t!="undefined"&&t!=null&&typeof t.spr.body!="undefined"&&t.spr.body!=null?(this.crownSpr.x=t.spr.body.x,this.crownSpr.y=t.spr.body.y-70,this.crownSpr.visible=!0):this.crownSpr.visible=!1,t.hasCrown=!0):n[i].name==Constants.MAIN_STATE.player.nameID?Constants.MAIN_STATE.player.hasCrown=!1:(t=this.findplayerbyid(n[i].name),typeof t!="undefined"&&t!=null&&typeof t.spr!="undefined"&&typeof t.spr.body!="undefined"&&(t.hasCrown=!1))},i.prototype.onRemoveEnemyPlayer=function(n){var t=this.findplayerbyid(n.id);if(!t){console.log("Player not found: ",n.id);return}t.destroy();window.game.enemies.splice(window.game.enemies.indexOf(t),1)},i.prototype.makeSpr=function(n){n===void 0&&(n=!1);var t=window.game.add.sprite(200,200,"simon",0,this.scaleGroup);return this.scaleGroup.add(t),t.anchor.setTo(.5),t.animations.add("walk",[0,1,2,1,0,3],10,!0),t.animations.add("jump",[4],4,!0),t.animations.add("idle",[0],4,!0),t.animations.add("fall",[0],4,!0),t.play("walk"),window.game.physics.p2.enable(t),t.body.rotation=-90,t.body.fixedRotation=!0,t.body.setCircle(18),n?t.body.mass=10:(t.body.mass=100,t.body.static=!0),t},i.prototype.getNameText=function(){var n=this.game.add.text(this.game.world.centerX,30,"1",{font:"Pixel Cyr",fill:"FFffff",align:"center",wordWrap:!0,wordWrapWidth:180});return n.anchor.setTo(.5,0),n.fontSize=17,n.lineSpacing=5,n.stroke="#000",n.strokeThickness=16,n.colors=["#FFffff"],n.stroke="#000",n.strokeThickness=2,n.x=this.game.world.width*.9,n.y=this.game.world.height*.05,n.text="User",n},i.prototype.makeEnemyPlayer=function(t,i){var u,r,f;if(i===void 0&&(i=!1),(typeof t=="undefined"||t==null)&&(console.log("created data instead of empty"),t={user:{name:"Ivan",score:0},character:{coords:{xabs:4,yabs:57},direction:-1,health:10}},i&&(t.user.name=Constants.PLAYER_NAME)),u=Constants.MAIN_STATE.makeSpr(i),r=new n.PlayerCtrl(window.game),r.spr=u,t.character!=null&&t.character.coords!=null?(console.log("make player. Name: "+t.user.name+". X tile: "+t.character.coords.x+", Y tile: "+t.character.coords.y),typeof t.character.coords.x!="undefined"?(u.body.x=t.character.coords.x*this.tileSize+this.tileSize*.5,u.body.y=t.character.coords.y*this.tileSize+this.tileSize*.5):(u.body.x=0,u.body.y=0)):(console.log("no info about coords"),u.body.x=0,u.body.y=0),t.user.name==null&&(t.user.name="User_0"),r.nameID=t.user.name,r.health=t.character.health,r.score=t.user.score,r.sessionID=t.user.session,f=new n.BarSpr(this.game,10,30,"fullBar","emptBar"),f.updateValues(100,100),r.addSprs(u,f,this.getNameText()),r.nameTextSpr.text=r.nameID,r.updateBarAndText(),i?(r.spr.name="player",Constants.MAIN_STATE.player=r,window.game.camera.follow(Constants.MAIN_STATE.player.spr),r.spr.body.setCollisionGroup(this.playerCollisionGr),r.spr.body.collides([this.tilesCollisionGr,this.enemyCollisionGr]),r.spr.body.createGroupCallback(this.enemyCollisionGr,Constants.MAIN_STATE.hitEnemy,this),Constants.MAIN_STATE.startGame()):(window.game.enemies.push(r),this.enemiesGroup.add(r),r.spr.name="enemy",r.spr.body.setCollisionGroup(this.enemyCollisionGr),r.spr.body.collides([Constants.MAIN_STATE.playerCollisionGr]),t.character.speed.x==0?(r.spr.animations.frame=0,r.spr.animations.stop("walk")):r.spr.animations.play("walk")),typeof t.character.swordColor!="undefined")switch(t.character.swordColor){case"white":r.swordSpr.tint=16777215;r.hitLineOuterSpr.tint=16777215;break;case"green":r.swordSpr.tint=65280;r.hitLineOuterSpr.tint=65280;break;case"blue":r.swordSpr.tint=255;r.hitLineOuterSpr.tint=255;break;case"red":r.swordSpr.tint=16711680;r.hitLineOuterSpr.tint=16711680}this.loseScreenSpr.bringToTop();this.playAgainBtn.bringToTop();this.gameOverText.bringToTop()},i.prototype.loadLvl=function(){var r,f,e,u,t,i,a,l,v;this.curLvl=0;this.curLvlCntrl=new n.Level1(this.game,this);typeof this.map!="undefined"&&this.map!=null&&this.map.destroy();this.map=this.game.add.tilemap("lvlLoad");this.map.setCollisionBetween(1,100,!0,"1");this.curLvlCntrl.init();this.map.addTilesetImage("traptiles","tileset",45,45,0,0,1);this.groundLayer=this.map.createLayer("1");this.backGroup.add(this.groundLayer);this.groundLayer.resizeWorld();var o=[],s=[],h=[],c=[];for(this.spawnPtsAr=[],r=45,f=0;f<this.map.height;++f)for(e=0;e<this.map.width;++e)if(u=this.map.getTile(e,f),u!=null){(u.index==4||u.index==8||u.index==7||u.index==5||u.index==3||u.index==6)&&this.map.removeTile(e,f,this.groundLayer);switch(u.index){case 4:s.push(u);break;case 8:o.push(u);break;case 7:c.push(u);break;case 5:h.push(u)}}for(t=0;t<s.length;++t)i=this.game.add.sprite(200,200,"doubleSpikes"),i.anchor.set(.5),i.x=s[t].x*r+r*.5,i.y=s[t].y*r+r*.5,this.curLvlCntrl.spikesGroup.add(i);for(t=0;t<o.length;++t)i=this.game.add.sprite(200,200,"doubleSpikesDown"),i.anchor.set(.5),i.x=o[t].x*r+r*.5,i.y=o[t].y*r+r*.5,this.curLvlCntrl.spikesGroup.add(i);for(t=0;t<c.length;++t)i=this.game.add.sprite(200,200,"doubleSpikesRight"),i.anchor.set(.5),i.x=c[t].x*r+r*.5,i.y=c[t].y*r+r*.5,this.curLvlCntrl.spikesGroup.add(i);for(t=0;t<h.length;++t)i=this.game.add.sprite(200,200,"doubleSpikesLeft"),i.anchor.set(.5),i.x=h[t].x*r+r*.5,i.y=h[t].y*r+r*.5,this.curLvlCntrl.spikesGroup.add(i);for(a=this.game.physics.p2.convertTilemap(this.map,this.groundLayer),this.game.physics.p2.setBoundsToWorld(!0,!0,!0,!0,!1),this.game.physics.p2.restitution=.1,this.game.physics.p2.gravity.y=800,this.game.physics.p2.world.defaultContactMaterial.friction=0,this.game.physics.p2.world.setGlobalStiffness(1e7),this.enemyCollisionGr=this.game.physics.p2.createCollisionGroup(),this.tilesCollisionGr=this.game.physics.p2.createCollisionGroup(),this.playerCollisionGr=this.game.physics.p2.createCollisionGroup(),l=0;l<a.length;l++)v=a[l],v.setCollisionGroup(this.tilesCollisionGr),v.collides([this.playerCollisionGr]);this.resize()},i.prototype.hitSpike=function(n,t){return console.log("hit spike"),t.alpha=.2,this.groundLayer.dirty=!0,!1},i.prototype.resetPlayerPos=function(){this.player.fall()},i.prototype.resetLevelPos=function(){typeof this.curLvlCntrl!="undefined"&&this.curLvlCntrl!=null&&this.curLvlCntrl.resetLvl();this.player.isDead=!1;this.noHitTimer=this.noHitTimer=this.game.time.now+350},i.prototype.destroLvl=function(){this.map.destroy();this.groundLayer.destroy();this.scaleGroup.removeChild(this.curLvlCntrl.platformGroup);this.curLvlCntrl.destroyLvl();this.curLvlCntrl=null},i.prototype.musicSwitch=function(){this.music.isPlaying?this.music.pause():this.music.resume()},i.prototype.startGame=function(){this.resize();this.livesLeft=this.livesMax;this.resetLevelPos();this.resetPlayerPos()},i.prototype.loseLife=function(){if(!this.loseScreenSpr.visible&&!window.checkGameOverScreenOn()&&!this.player.isShowingDeathAnim){if(this.game.time.now>this.noHitTimer)this.noHitTimer=this.game.time.now+2e3;else return;console.log("hit spike");window.game.socket.emit("hit",{damage:"spike",auth:Constants.MAIN_STATE.authInfo});Constants.MUSIC_ON&&Constants.MAIN_STATE.hitSnd.play();this.player.showHurt();var n=this.game.time.create(!0);n.repeat(700,1,this.resetLevelPos,this);n.start();this.player.health<=0}},i.prototype.cleanPlayers=function(){for(var n=0;n<window.game.enemies.length;n++)window.game.enemies[n]!=null&&window.game.enemies[n].destroy();window.game.enemies.splice(0,window.game.enemies.length)},i.prototype.endGame=function(){this.player.isDead||(this.curLvl=0,console.log("end game"),window.goldStat=this.player.score,window.killStat=this.player.killScore,window.timeStat=Utils.formatTime(this.curPlayTime/1e3),this.player.killerNameID.length>0?(window.killUser=this.player.killerNameID,this.gameOverText.visible=!0,this.gameOverText.text="Was killed by "+this.player.killerNameID):this.gameOverText.visible=!1,Constants.MAIN_STATE.upgrGr.upgradeLvlHeart=1,Constants.MAIN_STATE.upgrGr.upgradeLvlSword=1,Constants.MAIN_STATE.cleanPlayers(),window.game.physics.p2.clear(),window.averageFPS=this.allFps/this.countedFrames,this.allFps!=0&&window.game.socket.emit("stats",{minfps:window.game.time.fpsMin,avgfps:Math.floor(this.allFps/this.countedFrames),maxfps:window.game.time.fpsMax,id:Constants.MAIN_STATE.givenLoginID}),this.allFps=0,this.countedFrames=0,window.showGameOver(),this.game.paused=!0,this.player.stop(),ScaleControl.renew(this.game),this.playAgainBtn.visible&&this.add.tween(this.playAgainBtn.scale).to({y:1.1*ScaleControl.scaleMin,x:1.1*ScaleControl.scaleMin},500,Phaser.Easing.Elastic.Out,!0,0,-1,!0),this.loseScreenSpr.bringToTop(),this.playAgainBtn.bringToTop(),this.gameOverText.bringToTop(),this.gameOverText.x=this.game.width*.5,this.gameOverText.y=this.game.height*.6,this.playAgainBtn.x=this.game.width*.5,this.playAgainBtn.y=this.game.height*.8)},i.prototype.callCollide=function(){this.curLvl==0},i.prototype.controlTraps=function(){this.player.isDead||typeof this.curLvlCntrl!="undefined"&&this.curLvlCntrl!=null&&this.curLvlCntrl.update()},i.prototype.findplayerbyid=function(n){for(var t=0;t<window.game.enemies.length;t++)if(window.game.enemies[t].nameID==n)return window.game.enemies[t]},i.prototype.addText=function(t,i,r,u,f,e){u===void 0&&(u=null);f===void 0&&(f=!1);e===void 0&&(e=-1);var o=new n.AppearText(this.game,t,i);u!=null&&(o.playerBoundSpr=u,u.appearText=o);this.game.add.existing(o);o.text=r;e!=-1&&(o.timeAlive=e);o.launch();f&&(o.fixedToCamera=!0)},i.prototype.update=function(){this.upKey.justDown;this.upKey2.justDown&&(this.player.swordSpr.tint=255,this.player.hitLineOuterSpr.tint=255);this.allFps+=this.game.time.fps;this.countedFrames++;window.checkGameOverScreenOn()!=!1||this.game.paused||(this.curPlayTime+=this.game.time.elapsedMS);this.controlTraps();typeof this.player.spr!="undefined"&&this.player.spr!=null&&this.player.update()},i.prototype.endLvl=function(){this.curLvl<this.maxLvls-1?(this.curLvl++,this.destroLvl(),this.loadLvl(),this.startGame()):this.startGame()},i.prototype.resizeBtns=function(){},i.prototype.render=function(){this.fpsText.text="FPS: "+(String(this.game.time.fps)||"--")},i.prototype.updateHUDresize=function(){this.loseScreenSpr.height=this.game.height;this.loseScreenSpr.width=this.game.width;this.loseScreenSpr.anchor.setTo(0,0);this.loseScreenSpr.x=0;this.loseScreenSpr.y=0;this.gameOverText.x=this.game.width*.5;this.gameOverText.y=this.game.height*.6;this.gameOverText.fixedToCamera=!0;this.musicBtn.fixedToCamera=!0;this.musicBtn.x=this.game.width-40;this.musicBtn.y=this.leaderBoard.fillDarkSpr.y+this.leaderBoard.fillDarkSpr.height+40;this.musicBtn.fixedToCamera=!0;this.playAgainBtn.visible&&this.add.tween(this.playAgainBtn.scale).to({y:1.1*ScaleControl.scaleMin,x:1.1*ScaleControl.scaleMin},500,Phaser.Easing.Elastic.Out,!0,0,-1,!0);this.playAgainBtn.x=this.game.width*.5;this.playAgainBtn.y=this.game.height*.8;this.playAgainBtn.fixedToCamera=!0},i.prototype.resize=function(){(Constants.MAIN_STATE=this,this.game!=null&&this.game.world!=null)&&(ScaleControl.renew(this.game),this.game.width<this.game.height||(ScaleControl.hideTurn(),this.game.paused=!1),this.game!=null&&this.game.world!=null&&this.background!=null&&this.groundLayer!=null&&(this.player.renewUsualPhysics(),this.game!=null&&this.game.world!=null&&(this.groundLayer.resizeWorld(),this.groundLayer.resize(this.game.width,this.game.height)),this.underMapScale.scale.set(ScaleControl.scaleXUse,ScaleControl.scaleYUse),this.fpsText.fixedToCamera=!0,this.fpsText.x=5,this.fpsText.y=this.game.height-30,this.fpsText.fixedToCamera=!0,this.updateHUDresize(),this.leaderBoard.resize(),this.upgrGr.resize(),this.background.height=this.game.height,this.background.width=this.game.width,this.background.anchor.setTo(.5,.5),this.background.x=this.game.world.centerX,this.background.y=this.game.world.centerY))},i}(Phaser.State);n.PlayState=t}(BaseGame||(BaseGame={}));Constants=function(){function n(){}return n}();Constants.PLAYER_NAME="Name";Constants.GAME_SCALE=1;Constants.CALCULATED_WIDTH=0;Constants.CALCULATED_HEIGHT=0;Constants.GAME_WIDTH=990;Constants.GAME_HEIGHT=630;Constants.LANDSCAPE_LOCKED=!0;Constants.PORTRAIT_LOCKED=!1;Constants.MUSIC_ON=!0,function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.preload=function(){this.preloadBar=new n.BarSpr(this.game,this.game.world.centerX,this.game.world.centerY-20,"preloadBar","preloadBarEmpt");this.createAssets();ScaleControl.renew(this.game);this.resize()},i.prototype.createAssets=function(){var n=".";this.load.image("gameOver",n+"/assets/loading.png");this.load.spritesheet("simon",n+"/assets/avaSheet_1.png",25,35,5);this.load.image("back",n+"/assets/back.png");this.load.image("tileset",n+"/assets/tiles.png");this.load.image("tile",n+"/assets/tile45.png");this.load.image("tileUpside",n+"/assets/tile45Ups.png");this.load.image("tileEmpt",n+"/assets/tile45emp.png");this.load.audio("jumpSnd","./assets/audio/Jump.mp3",!0);this.load.audio("hurtSnd","./assets/audio/Hit_Hurt.mp3",!0);this.load.audio("pickupSnd","./assets/audio/PickupCoin.mp3",!0);this.load.audio("swooshSnd","./assets/audio/Swish.mp3",!0);this.load.image("onMusicBtn",n+"/assets/onMusicBtn.png");this.load.image("offMusicBtn",n+"/assets/offMusicBtn.png");this.load.image("sword",n+"/assets/sword.png");this.load.image("hitLineInner",n+"/assets/hitLineInner.png");this.load.image("hitLineOuter",n+"/assets/hitLineOuter.png");this.load.image("fullBar",n+"/assets/fullBar.png");this.load.image("emptBar",n+"/assets/emptBar.png");this.load.image("heartSpr",n+"/assets/hearBig.png");this.load.image("coin",n+"/assets/coin.png");this.load.image("swordIcon",n+"/assets/swordIcon.png");this.load.image("heartIcon",n+"/assets/heartIcon.png");this.load.image("doubleSpikes",n+"/assets/double_spikes.png");this.load.image("doubleSpikesDown",n+"/assets/double_spikes_down.png");this.load.image("doubleSpikesLeft",n+"/assets/double_spikes_left.png");this.load.image("doubleSpikesRight",n+"/assets/double_spikes_right.png");this.load.image("menuLogo",n+"/assets/loading.png");this.load.image("menuBack",n+"/assets/loading.png");this.load.image("menuStart",n+"/assets/loading.png");this.load.image("spikes",n+"/assets/spikes.png");this.load.image("exit",n+"/assets/exit60.png");this.load.image("bigBlock",n+"/assets/tileBigBlock.png");this.load.image("sideBlock",n+"/assets/platform_1.png");this.load.image("sideBlockSpikes",n+"/assets/sideSpikes1.png");this.load.image("pauseBtn",n+"/assets/pauseBtn.png");this.load.image("lifeBarFull",n+"/assets/lives10bar.png");this.load.image("lifeBarEmpt",n+"/assets/lives10empt.png");this.load.image("crown",n+"/assets/crown.png");this.load.image("gold",n+"/assets/gold.png")},i.prototype.loadUpdate=function(){this.preloadBar.setXY(this.game.world.centerX/ScaleControl.scaleXUse-this.preloadBar.width*.5/ScaleControl.scaleXUse,this.game.world.centerY/ScaleControl.scaleYUse);this.preloadBar.scale.x=ScaleControl.scaleX;this.preloadBar.scale.y=ScaleControl.scaleY;this.preloadBar.updateValues(this.load.progress,100)},i.prototype.create=function(){var n=this.add.tween(this.preloadBar).to({alpha:0},100,Phaser.Easing.Linear.None,!0);n.onComplete.add(this.startMainMenu,this);this.resize()},i.prototype.resize=function(){ScaleControl.renew(this.game);this.loadUpdate();this.preloadBar!=null&&this.preloadBar.scale.set(ScaleControl.scaleX,ScaleControl.scaleY)},i.prototype.startMainMenu=function(){ScaleControl.renew(this.game);window.document.getElementById("title").style.display!=="none"?(this.game.state.start("MainMenu",!0,!1),console.log("load menu"),window.$("#bannerSpr").show()):(this.game.state.start("PlayState",!0,!1),console.log("load play"))},i}(Phaser.State);n.Preloader=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.create=function(){this.background=this.add.sprite(0,0,"menuBack");this.background.alpha=0;this.playBtn=this.game.add.button(this.world.centerX,520,"menuStart");this.playBtn.anchor.setTo(.5);this.logo=this.add.sprite(this.world.centerX,-300,"menuLogo");this.logo.anchor.setTo(.5);this.add.tween(this.background).to({alpha:1},1e3,Phaser.Easing.Bounce.InOut,!0);this.add.tween(this.playBtn.scale).to({y:1.1,x:1.1},500,Phaser.Easing.Elastic.Out,!0,0,-1,!0);this.game.stage.disableVisibilityChange=!0;this.playBtn.events.onInputUp.add(function(){this.fadeOut()},this);window.game.loaded=!0;this.inputfield=this.game.add.inputField(10,10,{placeHolder:"Username",font:"22px Arial",width:250});this.inputfield.anchor.set(0,0);this.resize();this.background.visible=this.playBtn.visible=this.logo.visible=this.inputfield.visible=!1},t.prototype.fadeOut=function(){this.add.tween(this.background).to({alpha:0},500,Phaser.Easing.Linear.None,!0);var n=this.add.tween(this.playBtn).to({y:900},500,Phaser.Easing.Linear.None,!0);n.onComplete.add(this.startGame,this)},t.prototype.startGame=function(){this.background.visible=this.playBtn.visible=this.logo.visible=!1;Constants.PLAYER_NAME=this.inputfield.value;(Constants.PLAYER_NAME==""||Constants.PLAYER_NAME==null)&&(Constants.PLAYER_NAME="User");console.log("player name "+this.inputfield.value);this.game.state.start("PlayState",!0,!1)},t.prototype.update=function(){this.inputfield.update()},t.prototype.resize=function(){ScaleControl.scaleX=this.game.width/Constants.GAME_WIDTH;ScaleControl.scaleY=this.game.height/Constants.GAME_HEIGHT;ScaleControl.scaleMin=Math.min(ScaleControl.scaleX,ScaleControl.scaleY);this.game.width<this.game.height||ScaleControl.hideTurn();this.background!=null&&(this.background.height=this.game.height,this.background.width=this.game.width,this.background.anchor.setTo(.5,.5),this.background.x=this.game.world.centerX,this.background.y=this.game.world.centerY,this.playBtn.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin),this.playBtn.x=this.world.centerX,this.playBtn.y=520*ScaleControl.scaleY,this.add.tween(this.playBtn.scale).to({y:1.1*ScaleControl.scaleMin,x:1.1*ScaleControl.scaleMin},500,Phaser.Easing.Elastic.Out,!0,0,-1,!0),this.logo.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin),this.logo.x=this.world.centerX,this.logo.y=250*ScaleControl.scaleY,this.inputfield.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin),this.inputfield.x=this.world.centerX-this.inputfield.width*.5,this.inputfield.y=100*ScaleControl.scaleY)},t}(Phaser.State);n.MainMenu=t}(BaseGame||(BaseGame={})),function(n){var t=function(t){function i(){var i=t.call(this,990,630,Phaser.CANVAS,"game")||this;return i.enemies=[],i.hearts=[],i.coins=[],i.wallets=[],i.gameProperties={gameWidth:4e3,gameHeight:4e3,game_elemnt:"game",in_game:!1},i.state.add("Boot",n.Boot,!1),i.state.add("Preloader",n.Preloader,!1),i.state.add("MainMenu",n.MainMenu,!1),i.state.add("PlayState",n.PlayState,!1),i.state.start("Boot"),i}return __extends(i,t),i.prototype.createPlayer=function(){},i}(Phaser.Game);n.Game=t}(BaseGame||(BaseGame={}));window.onload=function(){window.game=new BaseGame.Game},function(n){var t=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r.trapsActivated=0,r.didVisit2Platform=!1,r.bigBlockMoved=!1,r.create(),r.addGroupsToState(),r}return __extends(t,n),t.prototype.create=function(){this.exitGr=this.game.add.group()},t.prototype.init=function(){},t.prototype.addGroupsToState=function(){},t.prototype.resetLvl=function(){},t.prototype.destroyLvl=function(){this.exitGr.forEach(function(n){n.destroy()},this,!1);this.startZone.destroy()},t.prototype.trapsControl=function(){},t.prototype.resize=function(){},t.prototype.update=function(){},t}(n.LevelBase);n.LevelBegin=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t){var i=n.call(this,t)||this;return i.fillDarkSpr=i.game.add.graphics(Constants.GAME_WIDTH,Constants.GAME_HEIGHT),i.fillDarkSpr.beginFill(0,.5),i.fillDarkSpr.drawRect(0,0,Constants.GAME_WIDTH,Constants.GAME_HEIGHT),i.fillDarkSpr.endFill(),i.fillDarkSpr.x=0,i.fillDarkSpr.y=0,i.allBtnsWidth=195,i.add(i.fillDarkSpr),console.log("created inside pause"),i.resize(),i.onChildInputDown.add(i.pressed,i),i}return __extends(t,n),t.prototype.pressed=function(){this.hide()},t.prototype.over=function(n){n.scale.set(ScaleControl.scaleMin*1.1,ScaleControl.scaleMin*1.1)},t.prototype.out=function(n){n.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin)},t.prototype.resize=function(){this.fillDarkSpr.height=this.game.height;this.fillDarkSpr.width=this.game.width;this.allBtnsWidth=285*ScaleControl.scaleMin},t.prototype.continueGame=function(){},t.prototype.switchSound=function(){this.checkLoadedMusicBtn()},t.prototype.checkLoadedMusicBtn=function(){},t.prototype.hide=function(){this.visible=!1},t.prototype.show=function(){this.resize();this.visible=!0;this.checkLoadedMusicBtn();console.log("show pause")},t.prototype.backToMenu=function(){this.game.paused=!1;this.visible=!1;this.game.state.start("MainMenu",!0,!1)},t}(Phaser.Group);n.LoseGroup=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t){var i=n.call(this,t)||this;return i.fillDarkSpr=i.game.add.graphics(Constants.GAME_WIDTH,Constants.GAME_HEIGHT),i.fillDarkSpr.beginFill(0,.7),i.fillDarkSpr.drawRoundedRect(0,0,300,350,5),i.fillDarkSpr.endFill(),i.fillDarkSpr.x=0,i.fillDarkSpr.y=0,i.allBtnsWidth=195,i.add(i.fillDarkSpr),i.fixedToCamera=!0,console.log("created inside pause"),i.resize(),i.checkLoadedMusicBtn(),i}return __extends(t,n),t.prototype.createTexts=function(){var n={font:"Pixel Cyr",fill:"FFffff",align:"left",wordWrap:!0,wordWrapWidth:280};this.textSpr=this.game.add.text(this.game.world.centerX,30,"1",n);this.textSpr.anchor.setTo(0,0);this.textSpr.fontSize=22;this.textSpr.align="left";this.textSpr.stroke="#000";this.textSpr.strokeThickness=16;this.textSpr.wordWrapWidth=350;this.textSpr.colors=["#F7DF3C"];this.textSpr.stroke="#000";this.textSpr.strokeThickness=2;this.textNamesSpr=this.game.add.text(this.game.world.centerX,30,"1",n);this.textNamesSpr.anchor.setTo(0,0);this.textNamesSpr.fontSize=22;this.textNamesSpr.align="left";this.textNamesSpr.stroke="#000";this.textNamesSpr.strokeThickness=16;this.textNamesSpr.wordWrapWidth=350;this.textNamesSpr.colors=["#FFffff"];this.textNamesSpr.stroke="#000";this.textNamesSpr.strokeThickness=2;this.textGoldSpr=this.game.add.text(this.game.world.centerX,30,"1",n);this.textGoldSpr.anchor.setTo(0,0);this.textGoldSpr.fontSize=22;this.textGoldSpr.align="left";this.textGoldSpr.stroke="#000";this.textGoldSpr.strokeThickness=16;this.textGoldSpr.colors=["#FFffff"];this.textGoldSpr.stroke="#000";this.textGoldSpr.strokeThickness=2;this.add(this.textSpr);this.add(this.textNamesSpr);this.add(this.textGoldSpr);this.fixedToCamera=!0},t.prototype.over=function(n){n.scale.set(ScaleControl.scaleMin*1.1,ScaleControl.scaleMin*1.1)},t.prototype.out=function(n){n.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin)},t.prototype.resize=function(){this.fillDarkSpr.y=10;this.fillDarkSpr.x=this.game.width-310;typeof this.textSpr!="undefined"&&(this.textSpr.x=this.fillDarkSpr.x+5,this.textSpr.y=this.fillDarkSpr.y,this.textNamesSpr.x=this.fillDarkSpr.x+5,this.textNamesSpr.y=this.fillDarkSpr.y+30,this.textGoldSpr.x=this.fillDarkSpr.x+255,this.textGoldSpr.y=this.fillDarkSpr.y+30)},t.prototype.renewText=function(n){var i,r,t;if(typeof this.textSpr!="undefined"){for(i="",r="",t=0;t<n.length;t++)i+=""+n[t].place+"    ",i+=n[t].name+"\n",r+=""+n[t].score+"\n";this.textSpr.text="Rank Name         Gold";this.textNamesSpr.text=i;this.textGoldSpr.text=r}},t.prototype.continueGame=function(){this.game.paused=!1;this.hide()},t.prototype.switchSound=function(){this.checkLoadedMusicBtn()},t.prototype.checkLoadedMusicBtn=function(){},t.prototype.hide=function(){this.visible=!1},t.prototype.show=function(){this.resize();this.visible=!0;this.checkLoadedMusicBtn();console.log("show leaderboard")},t.prototype.backToMenu=function(){this.game.paused=!1;this.visible=!1;this.game.state.start("MainMenu",!0,!1)},t}(Phaser.Group);n.LeaderBoardGr=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t){var i=n.call(this,t)||this;return i.upgradeLvlSword=1,i.upgradeLvlHeart=1,i.fillDarkSpr=i.game.add.graphics(195,165),i.fillDarkSpr.beginFill(0,.5),i.fillDarkSpr.drawRoundedRect(0,0,195,165,5),i.fillDarkSpr.endFill(),i.fillDarkSpr.x=10,i.fillDarkSpr.y=10,i.pricesAr=[10,30,60,100,150],i.swordBtn=i.game.add.button(i.fillDarkSpr.x-71*.5,i.fillDarkSpr.y+i.fillDarkSpr.height+10,"swordIcon",i.swordUpgrade,i,2,1,0),i.swordBtn.anchor.set(.5),i.heartBtn=i.game.add.button(i.swordBtn.x+i.swordBtn.width*.5+20,i.fillDarkSpr.y+i.fillDarkSpr.height+10,"heartIcon",i.heartUpgrade,i,2,1,0),i.heartBtn.anchor.set(.5),i.swordBtn.onInputOver.add(i.over,i,1,[i.swordBtn]),i.swordBtn.onInputOut.add(i.out,i,1,[i.swordBtn]),i.heartBtn.onInputOver.add(i.over,i,1,[i.heartBtn]),i.heartBtn.onInputOut.add(i.out,i,1,[i.heartBtn]),i.add(i.fillDarkSpr),i.add(i.swordBtn),i.add(i.heartBtn),console.log("created inside pause"),i.resize(),i.fixedToCamera=!0,i.renewInfoText(),i.checkVisibility(),i.tempRedrawTextsBtns(),i}return __extends(t,n),t.prototype.renewInfoText=function(){typeof this.textNamesSpr!="undefined"&&(this.textNamesSpr.text=""+Constants.MAIN_STATE.player.nameID,this.textSpr.text="Health: "+Constants.MAIN_STATE.player.health+"/"+Constants.MAIN_STATE.player.healthMax+"\nDamage: "+Constants.MAIN_STATE.player.damage+"\nGold: "+Constants.MAIN_STATE.player.score+"\nKills: "+Constants.MAIN_STATE.player.killScore)},t.prototype.checkVisibility=function(){(this.swordBtn.scale.set(1,1),this.heartBtn.scale.set(1,1),typeof this.textSwordIconLvl!="undefined")&&(Constants.MAIN_STATE.player.score>=this.needPriceForSword()?(this.updateBtnTexts(),this.textSwordIconLvl.anchor.setTo(.5),this.swordBtn.visible=this.textSwordIconLvl.visible=this.textSwordPrice.visible=!0):this.swordBtn.visible=this.textSwordIconLvl.visible=this.textSwordPrice.visible=!1,Constants.MAIN_STATE.player.score>=this.needPriceForHeart()?(this.updateBtnTexts(),this.textHeartIconLvl.anchor.setTo(.5),this.heartBtn.visible=this.textHeartIconLvl.visible=this.textHeartPrice.visible=!0):this.heartBtn.visible=this.textHeartIconLvl.visible=this.textHeartPrice.visible=!1)},t.prototype.needPriceForSword=function(){return this.pricesAr[this.upgradeLvlSword-1]},t.prototype.needPriceForHeart=function(){return this.pricesAr[this.upgradeLvlHeart-1]},t.prototype.tempRedrawTextsBtns=function(){typeof this.textSwordIconLvl!="undefined"&&(this.textSwordIconLvl.text="00"+this.upgradeLvlSword,this.textSwordPrice.text="00"+this.needPriceForSword()+" coins",this.textHeartIconLvl.text="00"+this.upgradeLvlHeart,this.textHeartPrice.text="00"+this.needPriceForHeart()+" coins")},t.prototype.updateBtnTexts=function(){typeof this.textSwordIconLvl!="undefined"&&(this.textSwordIconLvl.text=""+this.upgradeLvlSword,this.textSwordPrice.text=""+this.needPriceForSword()+" coins",this.textHeartIconLvl.text=""+this.upgradeLvlHeart,this.textHeartPrice.text=""+this.needPriceForHeart()+" coins")},t.prototype.swordUpgrade=function(){if(Constants.MAIN_STATE.player.score>=this.needPriceForSword()){if(window.game.socket.emit("upgradeBuy",{auth:Constants.MAIN_STATE.authInfo,type:"attack"}),this.upgradeLvlSword<5&&this.upgradeLvlSword++,this.checkVisibility(),typeof this.textSwordIconLvl=="undefined")return;this.textSwordIconLvl.text=""+this.upgradeLvlSword;this.textSwordPrice.text=""+this.needPriceForSword()+" coins";Constants.MAIN_STATE.addText(this.fillDarkSpr.x+this.fillDarkSpr.width*.5+70,this.fillDarkSpr.y+this.fillDarkSpr.height+100,"Your damage has increased!",null,!0)}},t.prototype.heartUpgrade=function(){if(Constants.MAIN_STATE.player.score>=this.needPriceForHeart()){if(window.game.socket.emit("upgradeBuy",{auth:Constants.MAIN_STATE.authInfo,type:"health"}),this.upgradeLvlHeart<5&&this.upgradeLvlHeart++,typeof this.textSwordIconLvl=="undefined")return;this.textHeartIconLvl.text=""+this.upgradeLvlHeart;this.textHeartPrice.text=""+this.needPriceForHeart()+" coins";this.checkVisibility();Constants.MAIN_STATE.addText(this.fillDarkSpr.x+this.fillDarkSpr.width*.5+70,this.fillDarkSpr.y+this.fillDarkSpr.height+125,"Your maximum health has increased!",null,!0)}},t.prototype.over=function(n){n.scale.set(1.1,1.1)},t.prototype.out=function(n){n.scale.set(1,1)},t.prototype.createTexts=function(){var n={font:"Pixel Cyr",fill:"FFffff",align:"left",wordWrap:!0,wordWrapWidth:280};this.textSpr=this.game.add.text(this.game.world.centerX,30,"0",n);this.textSpr.anchor.setTo(0,0);this.textSpr.fontSize=22;this.textSpr.align="left";this.textSpr.stroke="#000";this.textSpr.strokeThickness=16;this.textSpr.wordWrapWidth=350;this.textSpr.colors=["#FFffff"];this.textSpr.stroke="#000";this.textSpr.strokeThickness=2;this.textNamesSpr=this.game.add.text(this.game.world.centerX,30,"0",n);this.textNamesSpr.anchor.setTo(0,0);this.textNamesSpr.fontSize=25;this.textNamesSpr.align="left";this.textNamesSpr.stroke="#000";this.textNamesSpr.strokeThickness=16;this.textNamesSpr.wordWrapWidth=350;this.textNamesSpr.colors=["#F7DF3C"];this.textNamesSpr.stroke="#000";this.textNamesSpr.strokeThickness=2;this.textSwordIconLvl=this.game.add.text(this.game.world.centerX,30,"0",n);this.textSwordIconLvl.anchor.setTo(.5);this.textSwordIconLvl.fontSize=36;this.textSwordIconLvl.align="left";this.textSwordIconLvl.stroke="#000";this.textSwordIconLvl.strokeThickness=16;this.textSwordIconLvl.wordWrapWidth=350;this.textSwordIconLvl.colors=["#Ffffff"];this.textSwordIconLvl.stroke="#000";this.textSwordIconLvl.strokeThickness=2;this.textSwordPrice=this.game.add.text(this.game.world.centerX,30,"0",n);this.textSwordPrice.anchor.setTo(.5);this.textSwordPrice.fontSize=20;this.textSwordPrice.align="left";this.textSwordPrice.stroke="#000";this.textSwordPrice.strokeThickness=16;this.textSwordPrice.wordWrapWidth=350;this.textSwordPrice.colors=["#F7DF3C"];this.textSwordPrice.stroke="#000";this.textSwordPrice.strokeThickness=2;this.textHeartIconLvl=this.game.add.text(this.game.world.centerX,30,"0",n);this.textHeartIconLvl.anchor.setTo(.5);this.textHeartIconLvl.fontSize=36;this.textHeartIconLvl.align="left";this.textHeartIconLvl.stroke="#000";this.textHeartIconLvl.strokeThickness=16;this.textHeartIconLvl.wordWrapWidth=350;this.textHeartIconLvl.colors=["#Ffffff"];this.textHeartIconLvl.stroke="#000";this.textHeartIconLvl.strokeThickness=2;this.textHeartPrice=this.game.add.text(this.game.world.centerX,30,"0",n);this.textHeartPrice.anchor.setTo(.5);this.textHeartPrice.fontSize=20;this.textHeartPrice.align="left";this.textHeartPrice.stroke="#000";this.textHeartPrice.strokeThickness=16;this.textHeartPrice.wordWrapWidth=350;this.textHeartPrice.colors=["#F7DF3C"];this.textHeartPrice.stroke="#000";this.textHeartPrice.strokeThickness=2;this.textSwordIconLvl.x=this.swordBtn.x;this.textSwordIconLvl.y=this.swordBtn.y;this.textSwordPrice.x=this.swordBtn.x;this.textSwordPrice.y=this.swordBtn.y+this.swordBtn.height*.5+10;this.textHeartIconLvl.x=this.heartBtn.x;this.textHeartIconLvl.y=this.heartBtn.y;this.textHeartPrice.x=this.heartBtn.x;this.textHeartPrice.y=this.heartBtn.y+this.heartBtn.height*.5+10;this.add(this.textSpr);this.add(this.textNamesSpr);this.add(this.textSwordIconLvl);this.add(this.textSwordPrice);this.add(this.textHeartIconLvl);this.add(this.textHeartPrice)},t.prototype.resize=function(){typeof this.textSpr!="undefined"&&(this.textSpr.x=this.fillDarkSpr.x+5,this.textSpr.y=this.fillDarkSpr.y+35,this.textNamesSpr.x=this.fillDarkSpr.x+5,this.textNamesSpr.y=this.fillDarkSpr.y+5,this.swordBtn.x=this.fillDarkSpr.x+this.swordBtn.width*.5+10,this.swordBtn.y=this.fillDarkSpr.y+this.fillDarkSpr.height+this.swordBtn.height*.5+10,this.heartBtn.x=this.fillDarkSpr.x+this.fillDarkSpr.width-this.heartBtn.width*.5-10,this.heartBtn.y=this.fillDarkSpr.y+this.fillDarkSpr.height+this.heartBtn.height*.5+10,this.textSwordIconLvl.x=this.swordBtn.x,this.textSwordIconLvl.y=this.swordBtn.y,this.textSwordPrice.x=this.swordBtn.x,this.textSwordPrice.y=this.swordBtn.y+this.swordBtn.height*.5+10,this.textHeartIconLvl.x=this.heartBtn.x,this.textHeartIconLvl.y=this.heartBtn.y,this.textHeartPrice.x=this.heartBtn.x,this.textHeartPrice.y=this.heartBtn.y+this.heartBtn.height*.5+10)},t.prototype.continueGame=function(){},t.prototype.switchSound=function(){this.checkLoadedMusicBtn()},t.prototype.checkLoadedMusicBtn=function(){},t.prototype.hide=function(){this.visible=!1},t.prototype.show=function(){this.resize();this.visible=!0;this.checkLoadedMusicBtn();console.log("show pause")},t.prototype.backToMenu=function(){this.game.paused=!1;this.visible=!1;this.game.state.start("MainMenu",!0,!1)},t}(Phaser.Group);n.UpgradeGroup=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t){var i=n.call(this,t)||this;return i.fillDarkSpr=i.game.add.graphics(Constants.GAME_WIDTH,Constants.GAME_HEIGHT),i.fillDarkSpr.beginFill(0,.5),i.fillDarkSpr.drawRect(0,0,Constants.GAME_WIDTH,Constants.GAME_HEIGHT),i.fillDarkSpr.endFill(),i.fillDarkSpr.x=0,i.fillDarkSpr.y=0,i.allBtnsWidth=195,i.continueBtn=i.game.add.button(i.game.world.centerX-i.allBtnsWidth*.5,i.game.world.centerY,"continueBtn",i.continueGame,i,2,1,0),i.continueBtn.anchor.set(.5,.5),i.soundBtn=i.game.add.button(i.game.world.centerX,i.game.world.centerY,"sndOnSh",i.switchSound,i,2,1,0),i.soundBtn.anchor.set(.5,.5),i.menuBtn=i.game.add.button(i.game.world.centerX+i.allBtnsWidth*.5,i.game.world.centerY,"menuBtn",i.backToMenu,i,2,1,0),i.menuBtn.anchor.set(.5,.5),i.continueBtn.onInputOver.add(i.over,i,1,[i.continueBtn]),i.continueBtn.onInputOut.add(i.out,i,1,[i.continueBtn]),i.menuBtn.onInputOver.add(i.over,i,1,[i.menuBtn]),i.menuBtn.onInputOut.add(i.out,i,1,[i.menuBtn]),i.soundBtn.onInputOver.add(i.over,i,1,[i.soundBtn]),i.soundBtn.onInputOut.add(i.out,i,1,[i.soundBtn]),i.add(i.fillDarkSpr),i.add(i.continueBtn),i.add(i.soundBtn),i.add(i.menuBtn),console.log("created inside pause"),i.resize(),i.checkLoadedMusicBtn(),i}return __extends(t,n),t.prototype.over=function(n){n.scale.set(ScaleControl.scaleMin*1.1,ScaleControl.scaleMin*1.1)},t.prototype.out=function(n){n.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin)},t.prototype.resize=function(){this.fillDarkSpr.height=this.game.height;this.fillDarkSpr.width=this.game.width;this.continueBtn.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin);this.soundBtn.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin);this.menuBtn.scale.set(ScaleControl.scaleMin,ScaleControl.scaleMin);this.allBtnsWidth=285*ScaleControl.scaleMin;this.continueBtn.x=this.game.world.centerX-this.allBtnsWidth*.5;this.continueBtn.y=this.game.world.centerY;this.soundBtn.x=this.game.world.centerX;this.soundBtn.y=this.game.world.centerY;this.menuBtn.x=this.game.world.centerX+this.allBtnsWidth*.5;this.menuBtn.y=this.game.world.centerY},t.prototype.continueGame=function(){},t.prototype.switchSound=function(){this.checkLoadedMusicBtn()},t.prototype.checkLoadedMusicBtn=function(){},t.prototype.hide=function(){this.visible=!1},t.prototype.show=function(){this.resize();this.visible=!0;this.checkLoadedMusicBtn();console.log("show pause")},t.prototype.backToMenu=function(){this.game.paused=!1;this.visible=!1;this.game.state.start("MainMenu",!0,!1)},t}(Phaser.Group);n.PauseGroup=t}(BaseGame||(BaseGame={})),function(n){var t=function(n){function t(t,i,r){var u=n.call(this,t,i,r,"simon")||this;return u.anchor.setTo(.5),u.animations.add("walk",[0,1,2,1,0,3],14,!0),u.animations.add("jump",[4],4,!0),u.animations.add("idle",[0],4,!0),u.animations.add("fall",[0],4,!0),t.physics.p2.enable(u,!0),u.body.fixedRotation=!0,u.body.setCircle(18),u.setNoMoveTimer(),u}return __extends(t,n),t.prototype.checkIfCanJump=function(){for(var n,i,u=p2.vec2.fromValues(0,1),r=!1,t=0;t<this.game.physics.p2.world.narrowphase.contactEquations.length;t++)n=this.game.physics.p2.world.narrowphase.contactEquations[t],(n.bodyA===this.body.data||n.bodyB===this.body.data)&&(i=p2.vec2.dot(n.normalA,u),n.bodyA===this.body.data&&(i*=-1),i>.5&&(r=!0));return r},t.prototype.stop=function(){},t.prototype.renewUsualPhysics=function(){},t.prototype.fall=function(){},t.prototype.flySideTween=function(){this.stop();this.isDead=!0;console.log("fly side");this.fall();var n=this.game.add.tween(this).to({rotation:-10,y:this.y-100,x:this.x-100},400,Phaser.Easing.Linear.None,!0,0);n.onComplete.add(function(){console.log("ended scale");Constants.MAIN_STATE.resetPlayerPos();this.stop();this.renewUsualPhysics();this.firstSet=!1},this)},t.prototype.moveLeft=function(){this.game.time.now>this.noMoveSideTimer&&typeof Constants.MAIN_STATE.player!="undefined"&&typeof Constants.MAIN_STATE.player.spr.body!="undefined"&&typeof Constants.MAIN_STATE!="undefined"&&(Constants.MAIN_STATE.player.spr.body.velocity.x=-240,Constants.MAIN_STATE.player.renewUsualPhysics(),Constants.MAIN_STATE.player.spr.animations.play("walk"),Constants.MAIN_STATE.player.spr.scale.x===1&&(Constants.MAIN_STATE.player.spr.scale.x=-1))},t.prototype.moveRight=function(){this.game.time.now>this.noMoveSideTimer&&typeof Constants.MAIN_STATE.player!="undefined"&&typeof Constants.MAIN_STATE.player.spr.body!="undefined"&&typeof Constants.MAIN_STATE!="undefined"&&(Constants.MAIN_STATE.player.spr.body.velocity.x=240,Constants.MAIN_STATE.player.renewUsualPhysics(),Constants.MAIN_STATE.player.spr.animations.play("walk"),Constants.MAIN_STATE.player.spr.scale.x===-1&&(Constants.MAIN_STATE.player.spr.scale.x=1))},t.prototype.jump=function(){typeof Constants.MAIN_STATE.player.spr.body!="undefined"&&this.checkIfCanJump()&&typeof Constants.MAIN_STATE!="undefined"&&this.game.time.now>Constants.MAIN_STATE.jumpTimer&&(Constants.MAIN_STATE.player.spr.body.velocity.y=-130,Constants.MAIN_STATE.player.renewUsualPhysics(),Constants.MAIN_STATE.jumpTimer=Constants.MAIN_STATE.player.game.time.now+750,Constants.MAIN_STATE.player.spr.animations.play("jump"),this.overlappingPlatform&&(this.stopCurrentOverlap(),this.overlappingPlatform=!1))},t.prototype.setNoMoveTimer=function(){this.noMoveSideTimer=this.game.time.now+550},t.prototype.stopCurrentOverlap=function(){Constants.MAIN_STATE.curLvl==2},t.prototype.update=function(){var n=this;(this.body.x<0&&(this.body.x=0),this.body.velocity.x=0,Constants.MAIN_STATE.loseScreenSpr.visible)||(typeof Constants.MAIN_STATE!="undefined"&&(typeof Constants.MAIN_STATE.curLvlCntrl.platformGroup!="undefined"&&Constants.MAIN_STATE.curLvlCntrl.platformGroup.forEach(function(t){n.overlap(t)&&(t.isSet?n.body.velocity.y>0&&(n.stop(),Constants.MAIN_STATE.curLvl==1?t==Constants.MAIN_STATE.curLvlCntrl.platform2&&(Constants.MAIN_STATE.curLvlCntrl.spikesOnPlatform.visible&&Constants.MAIN_STATE.curLvlCntrl.launch1PlatformTo2(),Constants.MAIN_STATE.curLvlCntrl.didVisit2Platform=!0):Constants.MAIN_STATE.curLvl==2&&(t==Constants.MAIN_STATE.curLvlCntrl.platform1?(Constants.MAIN_STATE.curLvlCntrl.platform1.isActivated=!0,n.overlappingPlatform=!0):n.overlappingPlatform=!1)):n.renewUsualPhysics())},this,!1),typeof Constants.MAIN_STATE.curLvlCntrl.spikesGroup!="undefined"&&Constants.MAIN_STATE.curLvlCntrl.spikesGroup.forEach(function(t){n.overlap(t)&&(Constants.MAIN_STATE.loseLife(),n.body.velocity.y=0)},this,!1),typeof Constants.MAIN_STATE.curLvlCntrl.spikesOnPlatform!="undefined"&&Constants.MAIN_STATE.curLvlCntrl.spikesOnPlatform!=null&&this.overlap(Constants.MAIN_STATE.curLvlCntrl.spikesOnPlatform)&&Constants.MAIN_STATE.curLvlCntrl.spikesOnPlatform.visible&&(Constants.MAIN_STATE.loseLife(),this.body.velocity.y=0),typeof Constants.MAIN_STATE.curLvlCntrl.hiddenSpikesGroup!="undefined"&&Constants.MAIN_STATE.curLvlCntrl.hiddenSpikesGroup.forEach(function(t){n.overlap(t)&&t.visible&&(Constants.MAIN_STATE.loseLife(),n.body.velocity.y=0)},this,!1),typeof Constants.MAIN_STATE.curLvlCntrl.bigBlockGr!="undefined"&&Constants.MAIN_STATE.curLvlCntrl.bigBlockGr.forEach(function(t){n.overlap(t)&&t.visible&&t.body.velocity.y>0&&Constants.MAIN_STATE.loseLife()},this,!1)),this.holdRight&&(console.log("hold right"),this.moveRight()),this.holdLeft&&(console.log("hold Left"),this.moveLeft()),this.holdUp&&(console.log("hold up"),this.jump()),(this.game.input.keyboard.isDown(Phaser.Keyboard.UP)||this.game.input.keyboard.isDown(Phaser.Keyboard.W)||this.game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR))&&this.jump(),this.game.input.keyboard.isDown(Phaser.Keyboard.LEFT)||this.game.input.keyboard.isDown(Phaser.Keyboard.A)?this.moveLeft():this.game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)||this.game.input.keyboard.isDown(Phaser.Keyboard.D)?this.moveRight():this.holdRight||this.holdLeft||this.holdUp||(this.animations.frame=this.body.velocity.y<0?4:0))},t}(Phaser.Sprite);n.Player=t}(BaseGame||(BaseGame={})),function(n){function l(n,t){t===void 0&&(t=!1);var i=Math.floor(n/60)+":",r=Math.floor(n)%60;return r<10&&(i+="0"),i+=""+r,t&&(i+=".",r=Math.floor((n-Math.floor(n))*100),r<10&&(i+="0"),i+=""+r),i}function a(n,t){n===undefined&&(n="default");JSON.stringify(t);localStorage.setItem("save-"+n,t)}function v(n){n===undefined&&(n="default");var t=localStorage.getItem("save-"+n);return t&&typeof t!=undefined&&t!="undefined"?JSON.parse(t):-1}function y(n){return JSON.stringify(n)}function p(n){typeof n=="string"&&(n=JSON.parse(n));n.options.className}function h(n,t){var i=t.x-n.x,r=t.y-n.y;return Math.atan2(r,i)*c}function w(n,t,i){i===void 0&&(i=60);var r=h(n,t);return new Phaser.Point(Math.cos(r)*i,Math.sin(r)*i)}function b(n,t,i){i===void 0&&(i=60);var r=h(n,t);return r-=180,new Phaser.Point(Math.cos(r)*i,Math.sin(r)*i)}function k(n,t,i,r){i===void 0&&(i=0);r===void 0&&(r=0)}function d(n,h,c,l,a,v,y,p,w){return w===void 0&&(w=0),t=n-c*.5+w,f=n+c*.5-w,i=h-l*.5+w,e=h+l*.5-w,r=a-y*.5+w,o=a+y*.5-w,u=v-p*.5+w,s=v+p*.5-w,o>t&&r<f&&s>i&&u<e}function g(n,h,c){return c===void 0&&(c=0),t=n.x-n.width*n.anchor.x+c,f=t+n.width*n.scale.x-c*2,i=n.y-n.height*n.anchor.y+c,e=i+n.height*n.scale.y-c*2,r=h.x-h.width*h.anchor.x+c,o=r+h.width*h.scale.x-c*2,u=h.y-h.height*h.anchor.y+c,s=u+h.height*h.scale.y-c*2,o>t&&r<f&&s>i&&u<e}var c=180/Math.PI,t,f,i,e,r,o,u,s;n.formatTime=l;n.save=a;n.loadSave=v;n.serialize=y;n.unserialize=p;n.angleBetweenSprs=h;n.moveTowardsObject=w;n.moveFromObject=b;n.checkOverlap=k;n.overlapsRects=d;n.overlaps=g}(Utils||(Utils={}));